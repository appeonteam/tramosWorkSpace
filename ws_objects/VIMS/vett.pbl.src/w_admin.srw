$PBExportHeader$w_admin.srw
forward
global type w_admin from window
end type
type tab_admin from tab within w_admin
end type
type tp1 from userobject within tab_admin
end type
type cb_4 from commandbutton within tp1
end type
type sle_marops from singlelineedit within tp1
end type
type st_23 from statictext within tp1
end type
type cbx_flag from checkbox within tp1
end type
type cbx_enexp from checkbox within tp1
end type
type cbx_interface from checkbox within tp1
end type
type cb_rfrep from commandbutton within tp1
end type
type cb_open from commandbutton within tp1
end type
type sle_portsr from singlelineedit within tp1
end type
type dw_ports from datawindow within tp1
end type
type cb_saveemail from commandbutton within tp1
end type
type st_18 from statictext within tp1
end type
type sle_email from singlelineedit within tp1
end type
type cb_newfg from commandbutton within tp1
end type
type cb_savefg from commandbutton within tp1
end type
type dw_fg from datawindow within tp1
end type
type cb_delfg from commandbutton within tp1
end type
type cbx_log from checkbox within tp1
end type
type cb_deloffice from commandbutton within tp1
end type
type cb_newoffice from commandbutton within tp1
end type
type cb_saveoffice from commandbutton within tp1
end type
type dw_office from datawindow within tp1
end type
type cb_saversn from commandbutton within tp1
end type
type cb_delrsn from commandbutton within tp1
end type
type cb_newrsn from commandbutton within tp1
end type
type dw_rsn from datawindow within tp1
end type
type sle_temppath from singlelineedit within tp1
end type
type sle_apppath from singlelineedit within tp1
end type
type st_13 from statictext within tp1
end type
type st_11 from statictext within tp1
end type
type sle_footer from singlelineedit within tp1
end type
type dw_vsltype from datawindow within tp1
end type
type cb_newvtype from commandbutton within tp1
end type
type cb_delvtype from commandbutton within tp1
end type
type cb_savevtype from commandbutton within tp1
end type
type st_2 from statictext within tp1
end type
type st_3 from statictext within tp1
end type
type em_vslgreen from editmask within tp1
end type
type em_vslyellow from editmask within tp1
end type
type em_red from editmask within tp1
end type
type p_1 from picture within tp1
end type
type p_2 from picture within tp1
end type
type p_3 from picture within tp1
end type
type ddlb_green from dropdownlistbox within tp1
end type
type ddlb_yellow from dropdownlistbox within tp1
end type
type ddlb_red from dropdownlistbox within tp1
end type
type gb_5 from groupbox within tp1
end type
type gb_6 from groupbox within tp1
end type
type gb_14 from groupbox within tp1
end type
type gb_12 from groupbox within tp1
end type
type gb_16 from groupbox within tp1
end type
type gb_18 from groupbox within tp1
end type
type gb_17 from groupbox within tp1
end type
type gb_21 from groupbox within tp1
end type
type gb_22 from groupbox within tp1
end type
type tp1 from userobject within tab_admin
cb_4 cb_4
sle_marops sle_marops
st_23 st_23
cbx_flag cbx_flag
cbx_enexp cbx_enexp
cbx_interface cbx_interface
cb_rfrep cb_rfrep
cb_open cb_open
sle_portsr sle_portsr
dw_ports dw_ports
cb_saveemail cb_saveemail
st_18 st_18
sle_email sle_email
cb_newfg cb_newfg
cb_savefg cb_savefg
dw_fg dw_fg
cb_delfg cb_delfg
cbx_log cbx_log
cb_deloffice cb_deloffice
cb_newoffice cb_newoffice
cb_saveoffice cb_saveoffice
dw_office dw_office
cb_saversn cb_saversn
cb_delrsn cb_delrsn
cb_newrsn cb_newrsn
dw_rsn dw_rsn
sle_temppath sle_temppath
sle_apppath sle_apppath
st_13 st_13
st_11 st_11
sle_footer sle_footer
dw_vsltype dw_vsltype
cb_newvtype cb_newvtype
cb_delvtype cb_delvtype
cb_savevtype cb_savevtype
st_2 st_2
st_3 st_3
em_vslgreen em_vslgreen
em_vslyellow em_vslyellow
em_red em_red
p_1 p_1
p_2 p_2
p_3 p_3
ddlb_green ddlb_green
ddlb_yellow ddlb_yellow
ddlb_red ddlb_red
gb_5 gb_5
gb_6 gb_6
gb_14 gb_14
gb_12 gb_12
gb_16 gb_16
gb_18 gb_18
gb_17 gb_17
gb_21 gb_21
gb_22 gb_22
end type
type tp5 from userobject within tab_admin
end type
type dw_dept from datawindow within tp5
end type
type cb_savedept from commandbutton within tp5
end type
type cb_deldept from commandbutton within tp5
end type
type cb_newdept from commandbutton within tp5
end type
type cbx_vims from checkbox within tp5
end type
type cb_edituser from commandbutton within tp5
end type
type dw_users from datawindow within tp5
end type
type sle_search from singlelineedit within tp5
end type
type st_15 from statictext within tp5
end type
type gb_3 from groupbox within tp5
end type
type gb_4 from groupbox within tp5
end type
type tp5 from userobject within tab_admin
dw_dept dw_dept
cb_savedept cb_savedept
cb_deldept cb_deldept
cb_newdept cb_newdept
cbx_vims cbx_vims
cb_edituser cb_edituser
dw_users dw_users
sle_search sle_search
st_15 st_15
gb_3 gb_3
gb_4 gb_4
end type
type tp3 from userobject within tab_admin
end type
type em_mire from editmask within tp3
end type
type st_25 from statictext within tp3
end type
type st_24 from statictext within tp3
end type
type sle_pwd from singlelineedit within tp3
end type
type st_21 from statictext within tp3
end type
type sle_user from singlelineedit within tp3
end type
type st_20 from statictext within tp3
end type
type sle_acc from singlelineedit within tp3
end type
type st_19 from statictext within tp3
end type
type lb_files from listbox within tp3
end type
type cb_check from commandbutton within tp3
end type
type cb_insp from commandbutton within tp3
end type
type st_mng from statictext within tp3
end type
type st_super from statictext within tp3
end type
type cbx_sire from checkbox within tp3
end type
type htb_mng from htrackbar within tp3
end type
type st_17 from statictext within tp3
end type
type htb_super from htrackbar within tp3
end type
type st_16 from statictext within tp3
end type
type st_14 from statictext within tp3
end type
type htb_red from htrackbar within tp3
end type
type st_red from statictext within tp3
end type
type st_yellow from statictext within tp3
end type
type htb_yellow from htrackbar within tp3
end type
type st_1 from statictext within tp3
end type
type cb_savemgmt from commandbutton within tp3
end type
type dw_mgmt from datawindow within tp3
end type
type cb_savec from commandbutton within tp3
end type
type cb_delc from commandbutton within tp3
end type
type cb_newc from commandbutton within tp3
end type
type dw_cause from datawindow within tp3
end type
type cb_saver from commandbutton within tp3
end type
type cb_delr from commandbutton within tp3
end type
type cb_newr from commandbutton within tp3
end type
type dw_resp from datawindow within tp3
end type
type cb_savesm from commandbutton within tp3
end type
type cb_delsm from commandbutton within tp3
end type
type cb_newsm from commandbutton within tp3
end type
type dw_sm from datawindow within tp3
end type
type gb_9 from groupbox within tp3
end type
type gb_1 from groupbox within tp3
end type
type gb_2 from groupbox within tp3
end type
type gb_15 from groupbox within tp3
end type
type gb_19 from groupbox within tp3
end type
type gb_20 from groupbox within tp3
end type
type gb_23 from groupbox within tp3
end type
type gb_26 from groupbox within tp3
end type
type tp3 from userobject within tab_admin
em_mire em_mire
st_25 st_25
st_24 st_24
sle_pwd sle_pwd
st_21 st_21
sle_user sle_user
st_20 st_20
sle_acc sle_acc
st_19 st_19
lb_files lb_files
cb_check cb_check
cb_insp cb_insp
st_mng st_mng
st_super st_super
cbx_sire cbx_sire
htb_mng htb_mng
st_17 st_17
htb_super htb_super
st_16 st_16
st_14 st_14
htb_red htb_red
st_red st_red
st_yellow st_yellow
htb_yellow htb_yellow
st_1 st_1
cb_savemgmt cb_savemgmt
dw_mgmt dw_mgmt
cb_savec cb_savec
cb_delc cb_delc
cb_newc cb_newc
dw_cause dw_cause
cb_saver cb_saver
cb_delr cb_delr
cb_newr cb_newr
dw_resp dw_resp
cb_savesm cb_savesm
cb_delsm cb_delsm
cb_newsm cb_newsm
dw_sm dw_sm
gb_9 gb_9
gb_1 gb_1
gb_2 gb_2
gb_15 gb_15
gb_19 gb_19
gb_20 gb_20
gb_23 gb_23
gb_26 gb_26
end type
type tp2 from userobject within tab_admin
end type
type cb_offset from commandbutton within tp2
end type
type cb_savemodelcal from commandbutton within tp2
end type
type dw_inspmodel from datawindow within tp2
end type
type cb_clear from commandbutton within tp2
end type
type cb_save from commandbutton within tp2
end type
type cb_edit from commandbutton within tp2
end type
type cb_savetask from commandbutton within tp2
end type
type cb_deltask from commandbutton within tp2
end type
type cb_newtask from commandbutton within tp2
end type
type dw_task from datawindow within tp2
end type
type cb_remone from commandbutton within tp2
end type
type cb_getone from commandbutton within tp2
end type
type cb_remall from commandbutton within tp2
end type
type cb_getall from commandbutton within tp2
end type
type st_6 from statictext within tp2
end type
type dw_unlink from datawindow within tp2
end type
type dw_link from datawindow within tp2
end type
type st_5 from statictext within tp2
end type
type st_4 from statictext within tp2
end type
type dw_utype from datawindow within tp2
end type
type gb_7 from groupbox within tp2
end type
type gb_8 from groupbox within tp2
end type
type gb_10 from groupbox within tp2
end type
type tp2 from userobject within tab_admin
cb_offset cb_offset
cb_savemodelcal cb_savemodelcal
dw_inspmodel dw_inspmodel
cb_clear cb_clear
cb_save cb_save
cb_edit cb_edit
cb_savetask cb_savetask
cb_deltask cb_deltask
cb_newtask cb_newtask
dw_task dw_task
cb_remone cb_remone
cb_getone cb_getone
cb_remall cb_remall
cb_getall cb_getall
st_6 st_6
dw_unlink dw_unlink
dw_link dw_link
st_5 st_5
st_4 st_4
dw_utype dw_utype
gb_7 gb_7
gb_8 gb_8
gb_10 gb_10
end type
type tp6 from userobject within tab_admin
end type
type cb_clearbox from commandbutton within tp6
end type
type cbx_invims from checkbox within tp6
end type
type cbx_sn from checkbox within tp6
end type
type cbx_rep from checkbox within tp6
end type
type cbx_tract from checkbox within tp6
end type
type sle_vfind from singlelineedit within tp6
end type
type st_22 from statictext within tp6
end type
type dw_vslall from datawindow within tp6
end type
type gb_24 from groupbox within tp6
end type
type tp6 from userobject within tab_admin
cb_clearbox cb_clearbox
cbx_invims cbx_invims
cbx_sn cbx_sn
cbx_rep cbx_rep
cbx_tract cbx_tract
sle_vfind sle_vfind
st_22 st_22
dw_vslall dw_vslall
gb_24 gb_24
end type
type tp4 from userobject within tab_admin
end type
type cb_3 from commandbutton within tp4
end type
type cb_2 from commandbutton within tp4
end type
type cb_sendpass from commandbutton within tp4
end type
type cb_1 from commandbutton within tp4
end type
type cb_ping from commandbutton within tp4
end type
type cb_dupe from commandbutton within tp4
end type
type cb_password from commandbutton within tp4
end type
type cb_ddl from commandbutton within tp4
end type
type st_dbstatus from statictext within tp4
end type
type st_9 from statictext within tp4
end type
type st_8 from statictext within tp4
end type
type st_7 from statictext within tp4
end type
type cb_userupdate from commandbutton within tp4
end type
type cb_vslupdate from commandbutton within tp4
end type
type st_12 from statictext within tp4
end type
type st_dblast from statictext within tp4
end type
type cb_dbissue from commandbutton within tp4
end type
type st_dbver from statictext within tp4
end type
type st_10 from statictext within tp4
end type
type dw_userver from datawindow within tp4
end type
type cb_vmicuser from commandbutton within tp4
end type
type cb_vmicvsl from commandbutton within tp4
end type
type dw_vslver from datawindow within tp4
end type
type gb_11 from groupbox within tp4
end type
type gb_13 from groupbox within tp4
end type
type tp4 from userobject within tab_admin
cb_3 cb_3
cb_2 cb_2
cb_sendpass cb_sendpass
cb_1 cb_1
cb_ping cb_ping
cb_dupe cb_dupe
cb_password cb_password
cb_ddl cb_ddl
st_dbstatus st_dbstatus
st_9 st_9
st_8 st_8
st_7 st_7
cb_userupdate cb_userupdate
cb_vslupdate cb_vslupdate
st_12 st_12
st_dblast st_dblast
cb_dbissue cb_dbissue
st_dbver st_dbver
st_10 st_10
dw_userver dw_userver
cb_vmicuser cb_vmicuser
cb_vmicvsl cb_vmicvsl
dw_vslver dw_vslver
gb_11 gb_11
gb_13 gb_13
end type
type tab_admin from tab within w_admin
tp1 tp1
tp5 tp5
tp3 tp3
tp2 tp2
tp6 tp6
tp4 tp4
end type
end forward

global type w_admin from window
integer width = 3794
integer height = 2252
boolean titlebar = true
string title = "VIMS Admin"
boolean controlmenu = true
long backcolor = 67108864
string icon = "J:\TramosWS\VIMS\images\Vims\Admin.ico"
boolean center = true
event ue_retrieve ( )
tab_admin tab_admin
end type
global w_admin w_admin

type variables


n_filepackage invo_fpack

Integer ii_Super, ii_Mng, ii_MIREObs

String is_Email, is_PortNotes, is_MarOps
end variables

forward prototypes
public subroutine w_setdbstatus (integer ai_status)
public function long wf_createxml (string as_dw, string as_file, ref boolean abool_err)
public subroutine wf_finduser ()
public subroutine wf_setscrolltext (integer ai_pos, byte ab_num)
public subroutine wf_checkincoming (string ls_path)
private subroutine wf_checkportnotechange ()
public subroutine wf_findport ()
public subroutine wf_filtervsl ()
public subroutine wf_savevessel ()
end prototypes

event ue_retrieve();String ls_Value

SetPointer(HourGlass!)

tab_admin.tp1.dw_vsltype.SetTransobject(SQLCA)
tab_admin.tp1.dw_ports.SetTransobject(SQLCA)
tab_admin.tp5.dw_users.SetTransobject(SQLCA)
tab_admin.tp1.dw_Rsn.SetTransobject(SQLCA)
tab_admin.tp1.dw_Office.SetTransobject(SQLCA)
tab_admin.tp1.dw_FG.SetTransobject(SQLCA)
tab_admin.tp5.dw_dept.SetTransobject(SQLCA)
tab_admin.tp2.dw_utype.SetTransobject(SQLCA)
tab_admin.tp2.dw_link.SetTransobject(SQLCA)
tab_admin.tp2.dw_unlink.SetTransobject(SQLCA)
tab_admin.tp2.dw_task.SetTransobject(SQLCA)
tab_admin.tp2.dw_InspModel.SetTransobject(SQLCA)
tab_admin.tp3.dw_Mgmt.SetTransobject(SQLCA)
tab_admin.tp3.dw_SM.SetTransobject(SQLCA)
tab_admin.tp3.dw_cause.SetTransobject(SQLCA)
tab_admin.tp3.dw_resp.SetTransobject(SQLCA)
tab_admin.tp4.dw_vslver.SetTransObject(SQLCA)
tab_admin.tp4.dw_userver.SetTransObject(SQLCA)
tab_admin.tp6.dw_VslAll.SetTransObject(SQLCA)

tab_admin.tp1.sle_AppPath.Text = g_Obj.AppFolder
tab_admin.tp1.sle_TempPath.Text = g_Obj.TempFolder
tab_admin.tp1.dw_Rsn.Retrieve( )
tab_admin.tp1.dw_vsltype.Retrieve( )
tab_admin.tp1.dw_Office.Retrieve( )
tab_admin.tp1.dw_FG.Retrieve( )
tab_admin.tp1.dw_Ports.Retrieve()
tab_admin.tp5.dw_users.Retrieve( )
tab_admin.tp5.dw_dept.Retrieve( )
tab_admin.tp2.dw_utype.Retrieve( )
tab_admin.tp2.dw_task.Retrieve( )
tab_admin.tp2.dw_InspModel.Retrieve( )
tab_admin.tp3.dw_Mgmt.Retrieve( )
tab_admin.tp3.dw_SM.Retrieve( )
tab_admin.tp3.dw_cause.Retrieve( )
tab_admin.tp3.dw_resp.Retrieve( )
tab_admin.tp4.dw_vslver.Retrieve()
tab_admin.tp4.dw_userver.Retrieve()
tab_admin.tp6.dw_VslAll.Retrieve()

Commit;

tab_admin.tp1.sle_Footer.Text = g_Obj.Footer

tab_admin.tp1.em_vslgreen.Text = String(g_obj.ScoreGreen)
tab_admin.tp1.em_vslyellow.Text = String(g_obj.ScoreYellow)

tab_admin.tp1.ddlb_green.SelectItem( g_obj.inspgreen, 0)
tab_admin.tp1.ddlb_yellow.SelectItem( g_obj.inspyellow, 0)

tab_admin.tp1.ddlb_Red.SelectItem(1)

If f_Config("DBVR", ls_Value, 0) = 0 then tab_admin.tp4.st_dbver.Text = ls_Value else tab_admin.tp4.st_dbver.Text = "#"
If f_Config("DBLI", ls_Value, 0) = 0 then tab_admin.tp4.st_dbLast.Text = ls_Value else tab_admin.tp4.st_dbLast.Text = "<Error>"
If f_Config("EXDS", ls_Value, 0) = 0 then 
	If ls_Value = "0" then tab_admin.tp1.cbx_enexp.Checked = True
End If
If f_Config("VLOG", ls_Value, 0) = 0 then 
	If ls_Value = "1" then tab_admin.tp1.cbx_Log.Checked = True
End If
If f_Config("VSIF", ls_Value, 0) = 0 then 
	If ls_Value = "1" then tab_admin.tp1.cbx_Interface.Checked = True
End If

// Insp Due date Red status
f_Config("IDRD", ls_Value, 0)
If ls_Value = "" then ls_Value = "0"    // default - on due date
tab_admin.tp3.htb_Red.Position = Integer(ls_Value)
wf_SetScrollText(Integer(ls_Value), 0)
g_Obj.DueRed = Integer(ls_Value)

// Insp Due data Yellow status
f_Config("IDYL", ls_Value, 0)
If ls_Value = "" then ls_Value="-1"	   // default - one month before
tab_admin.tp3.htb_Yellow.Position = Integer(ls_Value)
wf_SetScrollText(Integer(ls_Value), 1)
g_Obj.DueYellow = Integer(ls_Value)

// SIRE Email Status
f_Config("SREM", ls_Value, 0)
If ls_Value = "1" Then tab_admin.tp3.cbx_Sire.Checked = True

// SIRE Email Super delay
f_Config("SRSP", ls_Value, 0)
If ls_Value = "" then ls_Value = "30"    // default - on due date
tab_admin.tp3.htb_Super.Position = Integer(ls_Value)
wf_SetScrollText(Integer(ls_Value), 2)
ii_Super = Integer(ls_value)

// SIRE Email Mng delay
f_Config("SRMG", ls_Value, 0)
If ls_Value = "" then ls_Value = "45"    // default - on due date
tab_admin.tp3.htb_Mng.Position = Integer(ls_Value)
wf_SetScrollText(Integer(ls_Value), 3)
ii_Mng = Integer(ls_value)

// MIRE Min Obs Count
f_Config("MMOC", ls_Value, 0)
If ls_Value = "" then ls_Value = "5"    // default - 5 obs min
tab_admin.tp3.em_Mire.Text = ls_Value
ii_MireObs = Integer(ls_value)

// OCIMF Web Services
f_Config("OCWA", ls_Value, 0)
tab_admin.tp3.sle_Acc.Text = ls_Value
f_Config("OCWU", ls_Value, 0)
tab_admin.tp3.sle_User.Text = ls_Value
f_Config("OCWP", ls_Value, 0)
tab_admin.tp3.sle_Pwd.Text = ls_Value

// Admin Email
f_Config("ADEM", is_Email, 0)
tab_admin.tp1.sle_email.text = is_Email

// MAROPS Email
f_Config("MOPS", is_MarOps, 0)
tab_admin.tp1.sle_marops.text = is_MarOps

w_setdbstatus(g_Obj.DBModif )
wf_FilterVsl()

end event

public subroutine w_setdbstatus (integer ai_status);
If ai_Status = -1 then
	This.tab_admin.tp4.st_dbstatus.Text = "< Error >"
	This.tab_admin.tp4.st_dbstatus.BackColor = 255
ElseIf ai_Status = 0 then
	This.tab_admin.tp4.st_dbstatus.Text = "Okay"
	This.tab_admin.tp4.st_dbstatus.BackColor = 32768
Else
	This.tab_admin.tp4.st_dbstatus.Text = "Modified"
	This.tab_admin.tp4.st_dbstatus.BackColor = 255
End If
end subroutine

public function long wf_createxml (string as_dw, string as_file, ref boolean abool_err);
Datastore lds_temp
Long ll_Rows

If abool_err then Return 0

lds_temp = Create datastore

lds_temp.DataObject = as_dw
lds_temp.SetTransObject(SQLCA)

ll_Rows = lds_temp.Retrieve( )

If ll_Rows > 0 then lds_temp.SaveAs(as_file + '.vdbxp', XML!, False)
If ll_Rows = -1 then abool_err = True

Return ll_Rows
end function

public subroutine wf_finduser ();// Finds user in list

Integer li_Found
String ls_Text

ls_Text = Lower(Trim(tab_admin.tp5.sle_Search.Text))

li_Found = tab_admin.tp5.dw_Users.Find("(Lower(FullName) like '%" + ls_Text + "%') Or (Lower(UserID) like '%" + ls_Text + "%')", 1, tab_admin.tp5.dw_Users.RowCount())

If li_Found > 0 then
	tab_admin.tp5.dw_Users.SetRow(li_Found)
	tab_admin.tp5.dw_Users.ScrollToRow(li_Found)
	tab_admin.tp5.dw_Users.SetRedraw(True)
End If

end subroutine

public subroutine wf_setscrolltext (integer ai_pos, byte ab_num);String ls_Text

If ab_Num=0 Then
	If tab_admin.tp3.htb_Yellow.Position > ai_Pos then
		tab_admin.tp3.htb_Yellow.Position = ai_Pos
		wf_SetScrollText(ai_Pos, 1)
	End If
ElseIf ab_Num=1 Then
	If tab_admin.tp3.htb_Red.Position < ai_Pos then
		tab_admin.tp3.htb_Red.Position = ai_Pos
		wf_SetScrollText(ai_Pos, 0)
	End If
ElseIf ab_Num=2 Then
	If tab_admin.tp3.htb_Mng.Position < ai_Pos then
		tab_admin.tp3.htb_Mng.Position = ai_Pos
		wf_SetScrollText(ai_Pos, 3)
	End If
ElseIf ab_Num=3 Then
	If tab_admin.tp3.htb_Super.Position > ai_Pos then
		tab_admin.tp3.htb_Super.Position = ai_Pos
		wf_SetScrollText(ai_Pos, 2)
	End If	
End If

If ai_Pos = 0 then
	ls_Text = "On Due Date"
Else
	ls_Text = String(Abs(ai_Pos))
	If ab_Num < 2 Then ls_Text += " month" Else ls_Text += " day"
	If Abs(ai_Pos) > 1 then ls_Text += "s"
	If ai_Pos > 0 then ls_Text += " after Due Date" Else ls_Text += " before Due Date"
End If

Choose Case ab_Num
	Case 0
		 tab_admin.tp3.st_Red.Text = ls_Text
	Case 1
		tab_admin.tp3.st_Yellow.Text = ls_Text
	Case 2
		tab_admin.tp3.st_Super.Text = ls_Text
	Case 3
		tab_admin.tp3.st_Mng.Text = ls_Text
End Choose

end subroutine

public subroutine wf_checkincoming (string ls_path);// This function is called from a timer and checks for any incoming packages.

String ls_CurFolder

// Get the file list
tab_admin.tp3.lb_Files.DirList(ls_path + "*.vpkg", 0)

// Change folder back to app folder
ChangeDirectory(g_Obj.AppFolder)

// If incoming found, call w_Import
If tab_admin.tp3.lb_Files.TotalItems()>0 then OpenWithParm(w_Import, ls_Path)

end subroutine

private subroutine wf_checkportnotechange ();// Checks if port note has been modified and enables 'Save' button
//
//If Trim(tab_admin.tp1.mle_Notes.text, True) <> is_PortNotes then
//	tab_admin.tp1.cb_PortSave.Enabled = True
//Else
//	tab_admin.tp1.cb_PortSave.Enabled = False
//End If
//
//tab_admin.tp1.cb_NoteClear.Enabled = (Trim(tab_admin.tp1.mle_Notes.text, True) > "")
end subroutine

public subroutine wf_findport ();// Function to find and highlight port

String ls_Text
Integer li_Found

ls_Text = Upper(Trim(tab_admin.tp1.sle_PortSr.Text,True))

If ls_Text="" then Return

li_Found = tab_admin.tp1.dw_Ports.Find("(Upper(Port_Code) like '%" + ls_Text + "%') or (Upper(Port_N) like '%" + ls_Text + "%')", 0, tab_admin.tp1.dw_Ports.RowCount())

If li_Found>0 then
	tab_admin.tp1.dw_Ports.SetRow(li_Found)
	tab_admin.tp1.dw_Ports.ScrollToRow(li_Found)
End If
end subroutine

public subroutine wf_filtervsl ();// Function to filter dw_VslAll

String ls_Filter=""
String ls_Txt

ls_Txt=Trim(Upper(tab_admin.tp6.sle_VFind.Text),True)

If ls_Txt>"" Then
	ls_Txt = " like '%" + ls_Txt + "%'"
	ls_Filter="((Upper(ref_nr)" + ls_Txt + ") or (Upper(name)" + ls_Txt + ") or (String(imo)" + ls_Txt + ") or (Upper(Office)" + ls_Txt + ") or (Upper(email)" + ls_Txt + ") or (Upper(country_country_name)" + ls_Txt + ") or (Upper(resp)"+ls_Txt+") or (Upper(super)"+ls_Txt+") or (Upper(vtype)"+ls_Txt+"))"
End If

If tab_Admin.tp6.cbx_TrAct.Checked then
	if ls_Filter>"" then ls_Filter += " and "
	ls_Filter += "Vessels_Vessel_Active=1"
End If

If tab_Admin.tp6.cbx_Rep.Checked then
	if ls_Filter>"" then ls_Filter += " and "
	ls_Filter += "(Not (IsNull(Vtype) Or IsNull(imo)))"
End If

If tab_Admin.tp6.cbx_SN.Checked then
	if ls_Filter>"" then ls_Filter += " and "
	ls_Filter += " snint=1"
End If

If tab_Admin.tp6.cbx_InVims.Checked then
	if ls_Filter>"" then ls_Filter += " and "
	ls_Filter += " invims=1"
End If

tab_admin.tp6.dw_VslAll.SetFilter(ls_Filter)
tab_admin.tp6.dw_VslAll.Filter()
end subroutine

public subroutine wf_savevessel ();// Save vessel DW

tab_admin.tp6.dw_vslall.update()

commit;
end subroutine

on w_admin.create
this.tab_admin=create tab_admin
this.Control[]={this.tab_admin}
end on

on w_admin.destroy
destroy(this.tab_admin)
end on

event open;
This.postevent("ue_retrieve")

end event

event closequery;
If tab_admin.tp1.dw_vsltype.Modifiedcount( ) + tab_admin.tp1.dw_vsltype.Deletedcount( ) > 0 then
	If MessageBox("Vessel Type Table", "The Vessel Type table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp1.dw_Office.Modifiedcount( ) + tab_admin.tp1.dw_Office.Deletedcount( ) > 0 then
	If MessageBox("Vetting Office Table", "The Vetting Office table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp1.dw_FG.Modifiedcount( ) + tab_admin.tp1.dw_FG.Deletedcount( ) > 0 then
	If MessageBox("Vetting Office Table", "The Fleet Group table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp1.dw_Rsn.Modifiedcount( ) + tab_admin.tp1.dw_Rsn.Deletedcount( ) > 0 then
	If MessageBox("Rejection Reasons", "The Rejection Reasons table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If Integer(tab_admin.tp1.em_vslgreen.Text) > 100 then
	MessageBox("Invalid Value", "A invalid value has been specified for the 'Green' Vessel Score.", Exclamation!)
	tab_admin.tp1.em_vslgreen.SetFocus( )
	Return 1
End If

If Integer(tab_admin.tp1.em_vslgreen.Text) < 20 then
	MessageBox("Invalid Value", "A invalid value has been specified for the 'Green' Vessel Score.", Exclamation!)
	tab_admin.tp1.em_vslgreen.SetFocus( )
	Return 1
End If

If Integer(tab_admin.tp1.em_vslyellow.Text) > 90 then
	MessageBox("Invalid Value", "A invalid value has been specified for the 'Yellow' Vessel Score.", Exclamation!)
	tab_admin.tp1.em_vslyellow.SetFocus( )
	Return 1
End If

If Integer(tab_admin.tp1.em_vslyellow.Text) < 10 then
	MessageBox("Invalid Value", "A invalid value has been specified for the 'Yellow' Vessel Score.", Exclamation!)
	tab_admin.tp1.em_vslyellow.SetFocus( )
	Return 1
End If

If Integer(tab_admin.tp1.em_vslyellow.Text) >= Integer(tab_admin.tp1.em_vslgreen.Text) then
	MessageBox("Invalid Value", "The 'Green' Vessel Score must be higher than the 'Yellow' Vessel Score.", Exclamation!)
	Return 1
End If

If tab_admin.tp1.ddlb_green.Text >= tab_admin.tp1.ddlb_yellow.Text then
	MessageBox("Invalid Value", "The 'Green' Inspection Rating must be higher than the 'Yellow' Inspection Rating.", Exclamation!)
	Return 1	
End If

If tab_admin.tp5.dw_users.Modifiedcount( ) + tab_admin.tp5.dw_users.Deletedcount( ) > 0 then
	If MessageBox("User Table", "The Users table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp5.dw_dept.Modifiedcount( ) + tab_admin.tp5.dw_dept.Deletedcount( ) > 0 then
	If MessageBox("Dept Table", "The Dept table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp2.cb_save.Enabled then
	If MessageBox("User's Inspection Capability", "The User's Inspection Capability table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp2.dw_task.Modifiedcount( ) + tab_admin.tp2.dw_task.Deletedcount( ) > 0 then
	If MessageBox("Task List", "The Task List table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp2.dw_inspmodel.Modifiedcount( ) > 0 then
	If MessageBox("Vessel Inspection Calendar", "The Vessel Inspection Calendar table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp3.dw_SM.Modifiedcount( ) + tab_admin.tp3.dw_SM.Deletedcount( ) > 0 then
	If MessageBox("Summary Types", "The Summary Types table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp3.dw_resp.Modifiedcount( ) + tab_admin.tp3.dw_resp.Deletedcount( ) > 0 then
	If MessageBox("Responsibility Table", "The Responsibility table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If tab_admin.tp3.dw_cause.Modifiedcount( ) + tab_admin.tp3.dw_cause.Deletedcount( ) > 0 then
	If MessageBox("Cause Table", "The Cause table has been modified but not saved. Are you sure you want to close?", Question!, YesNo!) = 2 then Return 1
End If

If Integer(tab_admin.tp1.em_vslgreen.Text) <> g_obj.scoregreen then
	g_obj.scoregreen = Integer(tab_admin.tp1.em_vslgreen.text)
	f_Config("VSGR", tab_admin.tp1.em_vslgreen.text, 1)
End If

If Integer(tab_admin.tp1.em_vslyellow.Text) <> g_obj.scoreyellow then
	g_obj.scoreyellow = Integer(tab_admin.tp1.em_vslyellow.text)
	f_Config("VSYL", tab_admin.tp1.em_vslyellow.text, 1)
End If

If tab_admin.tp1.ddlb_green.Text <> g_obj.Inspgreen then
	g_obj.inspgreen = tab_admin.tp1.ddlb_green.Text
	f_Config("INGR", g_obj.Inspgreen, 1)
End If

If tab_admin.tp1.ddlb_yellow.Text <> g_obj.Inspyellow then
	g_obj.inspyellow = tab_admin.tp1.ddlb_yellow.Text
	f_Config("INYL", g_obj.Inspyellow, 1)
End If

String ls_Val

If tab_admin.tp3.htb_Red.Position <> g_Obj.DueRed then
	ls_Val = String(tab_admin.tp3.htb_Red.Position)
	If f_Config("IDRD", ls_Val, 1) = 0 then g_Obj.DueRed = tab_admin.tp3.htb_Red.Position
End If

If tab_admin.tp3.htb_Yellow.Position <> g_Obj.DueYellow then
	ls_Val = String(tab_admin.tp3.htb_Yellow.Position)
	If f_Config("IDYL", ls_Val, 1) = 0 then g_Obj.DueYellow = tab_admin.tp3.htb_Yellow.Position
End If

If tab_admin.tp3.htb_Super.Position <> ii_Super then
	ls_Val = String(tab_admin.tp3.htb_Super.Position)
	f_Config("SRSP", ls_Val, 1)
End If

If tab_admin.tp3.htb_Mng.Position <> ii_Mng then
	ls_Val = String(tab_admin.tp3.htb_Mng.Position)
	f_Config("SRMG", ls_Val, 1)
End If

If Integer(tab_admin.tp3.em_Mire)<> ii_MireObs then
	ls_Val = String(tab_admin.tp3.em_Mire.Text)
	f_Config("MMOC", ls_Val, 1)
End If

// OCIMF Web Services
ls_Val = Trim(tab_admin.tp3.sle_Acc.Text,True)
f_Config("OCWA", ls_Val, 1)
ls_Val = Trim(tab_admin.tp3.sle_User.Text,True)
f_Config("OCWU", ls_Val, 1)
ls_Val = Trim(tab_admin.tp3.sle_Pwd.Text,True)
f_Config("OCWP", ls_Val, 1)

end event

type tab_admin from tab within w_admin
integer x = 18
integer y = 16
integer width = 3749
integer height = 2128
integer taborder = 10
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
boolean raggedright = true
boolean focusonbuttondown = true
integer selectedtab = 1
tp1 tp1
tp5 tp5
tp3 tp3
tp2 tp2
tp6 tp6
tp4 tp4
end type

on tab_admin.create
this.tp1=create tp1
this.tp5=create tp5
this.tp3=create tp3
this.tp2=create tp2
this.tp6=create tp6
this.tp4=create tp4
this.Control[]={this.tp1,&
this.tp5,&
this.tp3,&
this.tp2,&
this.tp6,&
this.tp4}
end on

on tab_admin.destroy
destroy(this.tp1)
destroy(this.tp5)
destroy(this.tp3)
destroy(this.tp2)
destroy(this.tp6)
destroy(this.tp4)
end on

type tp1 from userobject within tab_admin
integer x = 18
integer y = 112
integer width = 3712
integer height = 2000
long backcolor = 67108864
string text = "General"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
cb_4 cb_4
sle_marops sle_marops
st_23 st_23
cbx_flag cbx_flag
cbx_enexp cbx_enexp
cbx_interface cbx_interface
cb_rfrep cb_rfrep
cb_open cb_open
sle_portsr sle_portsr
dw_ports dw_ports
cb_saveemail cb_saveemail
st_18 st_18
sle_email sle_email
cb_newfg cb_newfg
cb_savefg cb_savefg
dw_fg dw_fg
cb_delfg cb_delfg
cbx_log cbx_log
cb_deloffice cb_deloffice
cb_newoffice cb_newoffice
cb_saveoffice cb_saveoffice
dw_office dw_office
cb_saversn cb_saversn
cb_delrsn cb_delrsn
cb_newrsn cb_newrsn
dw_rsn dw_rsn
sle_temppath sle_temppath
sle_apppath sle_apppath
st_13 st_13
st_11 st_11
sle_footer sle_footer
dw_vsltype dw_vsltype
cb_newvtype cb_newvtype
cb_delvtype cb_delvtype
cb_savevtype cb_savevtype
st_2 st_2
st_3 st_3
em_vslgreen em_vslgreen
em_vslyellow em_vslyellow
em_red em_red
p_1 p_1
p_2 p_2
p_3 p_3
ddlb_green ddlb_green
ddlb_yellow ddlb_yellow
ddlb_red ddlb_red
gb_5 gb_5
gb_6 gb_6
gb_14 gb_14
gb_12 gb_12
gb_16 gb_16
gb_18 gb_18
gb_17 gb_17
gb_21 gb_21
gb_22 gb_22
end type

on tp1.create
this.cb_4=create cb_4
this.sle_marops=create sle_marops
this.st_23=create st_23
this.cbx_flag=create cbx_flag
this.cbx_enexp=create cbx_enexp
this.cbx_interface=create cbx_interface
this.cb_rfrep=create cb_rfrep
this.cb_open=create cb_open
this.sle_portsr=create sle_portsr
this.dw_ports=create dw_ports
this.cb_saveemail=create cb_saveemail
this.st_18=create st_18
this.sle_email=create sle_email
this.cb_newfg=create cb_newfg
this.cb_savefg=create cb_savefg
this.dw_fg=create dw_fg
this.cb_delfg=create cb_delfg
this.cbx_log=create cbx_log
this.cb_deloffice=create cb_deloffice
this.cb_newoffice=create cb_newoffice
this.cb_saveoffice=create cb_saveoffice
this.dw_office=create dw_office
this.cb_saversn=create cb_saversn
this.cb_delrsn=create cb_delrsn
this.cb_newrsn=create cb_newrsn
this.dw_rsn=create dw_rsn
this.sle_temppath=create sle_temppath
this.sle_apppath=create sle_apppath
this.st_13=create st_13
this.st_11=create st_11
this.sle_footer=create sle_footer
this.dw_vsltype=create dw_vsltype
this.cb_newvtype=create cb_newvtype
this.cb_delvtype=create cb_delvtype
this.cb_savevtype=create cb_savevtype
this.st_2=create st_2
this.st_3=create st_3
this.em_vslgreen=create em_vslgreen
this.em_vslyellow=create em_vslyellow
this.em_red=create em_red
this.p_1=create p_1
this.p_2=create p_2
this.p_3=create p_3
this.ddlb_green=create ddlb_green
this.ddlb_yellow=create ddlb_yellow
this.ddlb_red=create ddlb_red
this.gb_5=create gb_5
this.gb_6=create gb_6
this.gb_14=create gb_14
this.gb_12=create gb_12
this.gb_16=create gb_16
this.gb_18=create gb_18
this.gb_17=create gb_17
this.gb_21=create gb_21
this.gb_22=create gb_22
this.Control[]={this.cb_4,&
this.sle_marops,&
this.st_23,&
this.cbx_flag,&
this.cbx_enexp,&
this.cbx_interface,&
this.cb_rfrep,&
this.cb_open,&
this.sle_portsr,&
this.dw_ports,&
this.cb_saveemail,&
this.st_18,&
this.sle_email,&
this.cb_newfg,&
this.cb_savefg,&
this.dw_fg,&
this.cb_delfg,&
this.cbx_log,&
this.cb_deloffice,&
this.cb_newoffice,&
this.cb_saveoffice,&
this.dw_office,&
this.cb_saversn,&
this.cb_delrsn,&
this.cb_newrsn,&
this.dw_rsn,&
this.sle_temppath,&
this.sle_apppath,&
this.st_13,&
this.st_11,&
this.sle_footer,&
this.dw_vsltype,&
this.cb_newvtype,&
this.cb_delvtype,&
this.cb_savevtype,&
this.st_2,&
this.st_3,&
this.em_vslgreen,&
this.em_vslyellow,&
this.em_red,&
this.p_1,&
this.p_2,&
this.p_3,&
this.ddlb_green,&
this.ddlb_yellow,&
this.ddlb_red,&
this.gb_5,&
this.gb_6,&
this.gb_14,&
this.gb_12,&
this.gb_16,&
this.gb_18,&
this.gb_17,&
this.gb_21,&
this.gb_22}
end on

on tp1.destroy
destroy(this.cb_4)
destroy(this.sle_marops)
destroy(this.st_23)
destroy(this.cbx_flag)
destroy(this.cbx_enexp)
destroy(this.cbx_interface)
destroy(this.cb_rfrep)
destroy(this.cb_open)
destroy(this.sle_portsr)
destroy(this.dw_ports)
destroy(this.cb_saveemail)
destroy(this.st_18)
destroy(this.sle_email)
destroy(this.cb_newfg)
destroy(this.cb_savefg)
destroy(this.dw_fg)
destroy(this.cb_delfg)
destroy(this.cbx_log)
destroy(this.cb_deloffice)
destroy(this.cb_newoffice)
destroy(this.cb_saveoffice)
destroy(this.dw_office)
destroy(this.cb_saversn)
destroy(this.cb_delrsn)
destroy(this.cb_newrsn)
destroy(this.dw_rsn)
destroy(this.sle_temppath)
destroy(this.sle_apppath)
destroy(this.st_13)
destroy(this.st_11)
destroy(this.sle_footer)
destroy(this.dw_vsltype)
destroy(this.cb_newvtype)
destroy(this.cb_delvtype)
destroy(this.cb_savevtype)
destroy(this.st_2)
destroy(this.st_3)
destroy(this.em_vslgreen)
destroy(this.em_vslyellow)
destroy(this.em_red)
destroy(this.p_1)
destroy(this.p_2)
destroy(this.p_3)
destroy(this.ddlb_green)
destroy(this.ddlb_yellow)
destroy(this.ddlb_red)
destroy(this.gb_5)
destroy(this.gb_6)
destroy(this.gb_14)
destroy(this.gb_12)
destroy(this.gb_16)
destroy(this.gb_18)
destroy(this.gb_17)
destroy(this.gb_21)
destroy(this.gb_22)
end on

type cb_4 from commandbutton within tp1
integer x = 1883
integer y = 1680
integer width = 233
integer height = 76
integer taborder = 250
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Save"
end type

event clicked;
String ls_Setting

sle_marops.Text =Trim(sle_marops.text, true)

If sle_marops.text= "" then
	Messagebox("Invalid Email", "Please specify a valid email address.", Exclamation!)
	Return
End If

If Pos(sle_marops.text, "@") = 0 or Pos(sle_marops.text, " ") > 0 or Pos(sle_marops.text, ".") = 0 then
	Messagebox("Invalid Email", "Please specify a valid email address.", Exclamation!)
	Return
End If

is_MarOps = sle_marops.text

If f_Config("MOPS", is_MarOps, 1) = 0 then
	Messagebox("Success", "MAROPS email changed.")
	this.Enabled = false
Else
	Messagebox("DB Error", "Unable to save email address.", Exclamation!)
End If
end event

type sle_marops from singlelineedit within tp1
integer x = 1317
integer y = 1600
integer width = 805
integer height = 76
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
textcase textcase = lower!
borderstyle borderstyle = stylelowered!
end type

type st_23 from statictext within tp1
integer x = 1317
integer y = 1536
integer width = 462
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "MAROPS Email"
boolean focusrectangle = false
end type

type cbx_flag from checkbox within tp1
integer x = 2871
integer y = 960
integer width = 384
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Flagged Only"
end type

event clicked;
If this.Checked Then dw_Ports.SetFilter("Vett_RedFlag=1") Else dw_Ports.SetFilter("")

dw_Ports.Filter()
end event

type cbx_enexp from checkbox within tp1
integer x = 1317
integer y = 1120
integer width = 663
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Enable Inspection Export"
end type

event clicked;String ls_Setting

If this.Checked Then ls_Setting = "0" Else ls_Setting = "1"

f_Config("EXDS", ls_Setting, 1)
end event

type cbx_interface from checkbox within tp1
integer x = 1317
integer y = 1200
integer width = 782
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
string text = "Enable VIMS-ShipNet Interface"
end type

event clicked;String ls_Setting

If this.Checked Then ls_Setting = "1" Else ls_Setting = "0"

f_Config("VSIF", ls_Setting, 1)
end event

type cb_rfrep from commandbutton within tp1
integer x = 2249
integer y = 1872
integer width = 215
integer height = 80
integer taborder = 240
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Report"
end type

event clicked;OpenSheet(w_preview, w_main, 0, Original!)

w_preview.dw_rep.dataobject = "d_sq_tb_redflagportreport"

w_preview.dw_rep.SetTransObject(SQLCA)

w_preview.dw_rep.Retrieve()

w_preview.dw_rep.object.datawindow.print.preview='Yes'

w_preview.wf_ShowReport()

Commit;
end event

type cb_open from commandbutton within tp1
integer x = 3419
integer y = 1872
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Open"
end type

event clicked;
If dw_Ports.GetRow()<=0 Then Return

OpenWithParm(w_RedFlag, dw_Ports.GetItemString(dw_Ports.GetRow(), "Port_Code"))
end event

type sle_portsr from singlelineedit within tp1
event ue_keyup pbm_keyup
integer x = 3273
integer y = 960
integer width = 347
integer height = 76
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 12632256
string text = "Search"
borderstyle borderstyle = stylelowered!
end type

event ue_keyup;
Post wf_FindPort()
end event

event modified;
This.backcolor = 16777215   // White
end event

event losefocus;
this.text="Search"
this.textcolor=13027014
this.backcolor=16777215
end event

event getfocus;
this.text=""
this.textcolor=0

end event

type dw_ports from datawindow within tp1
integer x = 2249
integer y = 1040
integer width = 1371
integer height = 832
integer taborder = 170
string dataobject = "d_sq_tb_ports"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event rowfocuschanged;
// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to force refresh of row colors when using arrow keys to navigate
This.SetRedraw(True)

end event

event clicked;string ls_sort

If (dwo.type = "text") then
	If (dwo.tag>"") then
		ls_sort = dwo.Tag
		this.setSort(ls_sort)
		this.Sort()
		if right(ls_sort,1) = "A" then 
			ls_sort = replace(ls_sort, len(ls_sort),1, "D")
		else
			ls_sort = replace(ls_sort, len(ls_sort),1, "A")
		end if
		dwo.Tag = ls_sort
	End If
End if

end event

event doubleclicked;
If row>0 Then cb_open.event clicked( )

end event

type cb_saveemail from commandbutton within tp1
integer x = 1883
integer y = 1456
integer width = 233
integer height = 76
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Save"
end type

event clicked;
String ls_Setting

sle_email.Text =Trim(sle_email.text, true)

If sle_email.text= "" then
	Messagebox("Invalid Email", "Please specify a valid email address.", Exclamation!)
	Return
End If

If Pos(sle_email.text, "@") = 0 or Pos(sle_email.text, " ") > 0 or Pos(sle_email.text, ".") = 0 then
	Messagebox("Invalid Email", "Please specify a valid email address.", Exclamation!)
	Return
End If

is_Email = sle_email.text

If f_Config("ADEM", is_Email, 1) = 0 then
	Messagebox("Success", "Administrator email changed.")
	this.Enabled = false
Else
	Messagebox("DB Error", "Unable to save email address.", Exclamation!)
End If
end event

type st_18 from statictext within tp1
integer x = 1317
integer y = 1312
integer width = 462
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Administrator Email"
boolean focusrectangle = false
end type

type sle_email from singlelineedit within tp1
event ue_keyup pbm_keyup
integer x = 1317
integer y = 1376
integer width = 805
integer height = 76
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
textcase textcase = lower!
borderstyle borderstyle = stylelowered!
end type

type cb_newfg from commandbutton within tp1
integer x = 2761
integer y = 848
integer width = 201
integer height = 80
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_fg.InsertRow(0)

If li_NewRow > 0 then
	dw_fg.SetItem(li_NewRow, "FgName", "<New Fleet Group>")
	cb_Savefg.Enabled = True
	cb_Delfg.Enabled = True
	dw_fg.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type cb_savefg from commandbutton within tp1
integer x = 3346
integer y = 848
integer width = 201
integer height = 80
integer taborder = 250
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;
SetPointer (HourGlass!)

If dw_fg.Update( ) = 1 then
	Messagebox ("Saved", "The Fleet Group table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Fleet Group table could not be saved successfully.", Exclamation!)
End If

Commit;

dw_fg.Retrieve( )

end event

type dw_fg from datawindow within tp1
integer x = 2761
integer y = 112
integer width = 786
integer height = 736
integer taborder = 10
string title = "none"
string dataobject = "d_sq_tb_fleetgroup"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event editchanged;
cb_SaveFG.Enabled = True
end event

event retrieveend;
If (rowcount > 0) then cb_delOffice.Enabled = True
end event

type cb_delfg from commandbutton within tp1
integer x = 2962
integer y = 848
integer width = 201
integer height = 80
integer taborder = 260
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
dw_fg.DeleteRow( dw_fg.GetRow())

cb_Savefg.Enabled = True

If dw_fg.RowCount( ) = 0 then This.Enabled = False

end event

type cbx_log from checkbox within tp1
integer x = 1317
integer y = 1040
integer width = 704
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
string text = "Enable Application Logging"
end type

event clicked;String ls_Setting

If this.Checked Then ls_Setting = "1" Else ls_Setting = "0"

f_Config("VLOG", ls_Setting, 1)
end event

type cb_deloffice from commandbutton within tp1
integer x = 1170
integer y = 848
integer width = 201
integer height = 80
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
dw_Office.DeleteRow( dw_Office.GetRow())

cb_SaveOffice.Enabled = True

If dw_Office.RowCount( ) = 0 then This.Enabled = False

end event

type cb_newoffice from commandbutton within tp1
integer x = 969
integer y = 848
integer width = 201
integer height = 80
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_Office.InsertRow(0)

If li_NewRow > 0 then
	dw_Office.SetItem(li_NewRow, "officename", "<New Office>")
	cb_SaveOffice.Enabled = True
	cb_DelOffice.Enabled = True
	dw_Office.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type cb_saveoffice from commandbutton within tp1
integer x = 1554
integer y = 848
integer width = 201
integer height = 80
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;SetPointer (HourGlass!)

If dw_Office.Update( ) = 1 then
	Messagebox ("Saved", "The Vetting Offices table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Vetting Offices table could not be saved successfully.",Exclamation!)
	dw_Office.Retrieve( )
End If

Commit;
end event

type dw_office from datawindow within tp1
integer x = 969
integer y = 112
integer width = 786
integer height = 736
integer taborder = 190
string title = "none"
string dataobject = "d_sq_tb_office"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event editchanged;
cb_SaveOffice.Enabled = True
end event

event retrieveend;
If (rowcount > 0) then cb_delOffice.Enabled = True
end event

type cb_saversn from commandbutton within tp1
integer x = 2450
integer y = 848
integer width = 201
integer height = 80
integer taborder = 190
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;
SetPointer (HourGlass!)

If dw_Rsn.Update( ) = 1 then
	Messagebox ("Saved", "The Rejection Reasons table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Rejection Reasons table could not be saved successfully.", Exclamation!)
End If

Commit;

dw_Rsn.Retrieve( )

end event

type cb_delrsn from commandbutton within tp1
integer x = 2066
integer y = 848
integer width = 201
integer height = 80
integer taborder = 250
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
dw_Rsn.DeleteRow( dw_Rsn.GetRow())

cb_SaveRsn.Enabled = True

If dw_Rsn.RowCount( ) = 0 then This.Enabled = False

end event

type cb_newrsn from commandbutton within tp1
integer x = 1865
integer y = 848
integer width = 201
integer height = 80
integer taborder = 240
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_Rsn.InsertRow(0)

If li_NewRow > 0 then
	dw_Rsn.SetItem(li_NewRow, "Reason", "<New Reason>")
	cb_SaveRsn.Enabled = True
	cb_DelRsn.Enabled = True
	dw_Rsn.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type dw_rsn from datawindow within tp1
integer x = 1865
integer y = 112
integer width = 786
integer height = 736
integer taborder = 190
string title = "none"
string dataobject = "d_sq_tb_rejrsn"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;
cb_SaveRsn.Enabled = True
end event

event retrieveend;
If (rowcount > 0) then cb_delRsn.Enabled = True
end event

type sle_temppath from singlelineedit within tp1
integer x = 256
integer y = 1664
integer width = 933
integer height = 64
integer taborder = 180
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 15793151
string text = "none"
boolean displayonly = true
borderstyle borderstyle = stylelowered!
end type

type sle_apppath from singlelineedit within tp1
integer x = 256
integer y = 1584
integer width = 933
integer height = 64
integer taborder = 180
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Arial"
long textcolor = 33554432
long backcolor = 15793151
string text = "none"
boolean displayonly = true
borderstyle borderstyle = stylelowered!
end type

type st_13 from statictext within tp1
integer x = 91
integer y = 1664
integer width = 146
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Temp:"
boolean focusrectangle = false
end type

type st_11 from statictext within tp1
integer x = 91
integer y = 1584
integer width = 146
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "App:"
boolean focusrectangle = false
end type

type sle_footer from singlelineedit within tp1
integer x = 73
integer y = 1856
integer width = 2048
integer height = 80
integer taborder = 190
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
integer limit = 200
borderstyle borderstyle = stylelowered!
end type

event modified;
sle_Footer.Text= Trim(sle_Footer.Text)

If f_Config("FOOT",sle_footer.Text,1)<0 then
	MessageBox("DB Error", "Could not save footer text into Database.",Exclamation!)
Else
	g_Obj.Footer = sle_footer.Text
End If
end event

type dw_vsltype from datawindow within tp1
integer x = 73
integer y = 112
integer width = 786
integer height = 736
integer taborder = 150
string title = "none"
string dataobject = "d_sq_tb_vetttype"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event retrieveend;
If (rowcount > 0) then cb_delVType.Enabled = True
end event

event editchanged;
cb_SaveVType.Enabled = True
end event

event itemchanged;
cb_SaveVType.Enabled = True
end event

type cb_newvtype from commandbutton within tp1
integer x = 73
integer y = 848
integer width = 201
integer height = 80
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_VslType.InsertRow(0)

If li_NewRow > 0 then
	dw_VslType.SetItem(li_NewRow, "type_name", "<New Type>")
	cb_SaveVType.Enabled = True
	cb_DelVType.Enabled = True
	dw_VslType.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type cb_delvtype from commandbutton within tp1
integer x = 274
integer y = 848
integer width = 201
integer height = 80
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
dw_VslType.DeleteRow( dw_VslType.GetRow())

cb_SaveVType.Enabled = True

If dw_VslType.RowCount( ) = 0 then This.Enabled = False

end event

type cb_savevtype from commandbutton within tp1
integer x = 658
integer y = 848
integer width = 201
integer height = 80
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;SetPointer (HourGlass!)

If dw_VslType.Update( ) = 1 then
	Messagebox ("Saved", "The Vessel Type table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Vessel Type table could not be saved successfully.",Exclamation!)
	dw_VslType.Retrieve( )
End If

Commit;
end event

type st_2 from statictext within tp1
integer x = 439
integer y = 1024
integer width = 201
integer height = 112
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Vessel Score"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_3 from statictext within tp1
integer x = 823
integer y = 1024
integer width = 274
integer height = 112
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Inspection Rating"
alignment alignment = center!
boolean focusrectangle = false
end type

type em_vslgreen from editmask within tp1
integer x = 421
integer y = 1152
integer width = 238
integer height = 80
integer taborder = 150
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "0"
alignment alignment = right!
borderstyle borderstyle = stylelowered!
string mask = "##0"
boolean spin = true
string minmax = "20~~100"
end type

event modified;

If Integer(em_vslgreen.Text) <= Integer(em_vslyellow.Text) then
	em_vslyellow.Text = String(Integer(em_vslgreen.Text) - 1)
End If
end event

type em_vslyellow from editmask within tp1
integer x = 421
integer y = 1248
integer width = 238
integer height = 80
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "0"
alignment alignment = right!
borderstyle borderstyle = stylelowered!
string mask = "##0"
boolean spin = true
string minmax = "10~~90"
end type

event modified;
If Integer(em_vslgreen.Text) <= Integer(em_vslyellow.Text) then
	em_vslgreen.Text = String(Integer(em_vslyellow.Text) + 1)
End If
end event

type em_red from editmask within tp1
integer x = 421
integer y = 1344
integer width = 238
integer height = 80
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
string text = "0"
alignment alignment = right!
borderstyle borderstyle = stylelowered!
string mask = "##0"
boolean spin = true
string minmax = "20~~100"
end type

type p_1 from picture within tp1
integer x = 146
integer y = 1168
integer width = 73
integer height = 64
boolean originalsize = true
string picturename = "J:\TramosWS\VIMS\images\Vims\LED_Green_T.gif"
boolean focusrectangle = false
end type

type p_2 from picture within tp1
integer x = 146
integer y = 1264
integer width = 73
integer height = 64
boolean originalsize = true
string picturename = "J:\TramosWS\VIMS\images\Vims\LED_Yellow_T.gif"
boolean focusrectangle = false
end type

type p_3 from picture within tp1
integer x = 146
integer y = 1360
integer width = 73
integer height = 64
boolean originalsize = true
string picturename = "J:\TramosWS\VIMS\images\Vims\LED_Red_T.gif"
boolean focusrectangle = false
end type

type ddlb_green from dropdownlistbox within tp1
integer x = 859
integer y = 1152
integer width = 219
integer height = 368
integer taborder = 150
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean sorted = false
string item[] = {"A","B","C"}
borderstyle borderstyle = stylelowered!
end type

type ddlb_yellow from dropdownlistbox within tp1
integer x = 859
integer y = 1248
integer width = 219
integer height = 480
integer taborder = 150
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean sorted = false
boolean vscrollbar = true
string item[] = {"B","C","D","E"}
borderstyle borderstyle = stylelowered!
end type

type ddlb_red from dropdownlistbox within tp1
integer x = 859
integer y = 1344
integer width = 219
integer height = 288
integer taborder = 150
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean enabled = false
boolean sorted = false
string item[] = {"F","","",""}
borderstyle borderstyle = stylelowered!
end type

type gb_5 from groupbox within tp1
integer x = 37
integer y = 32
integer width = 859
integer height = 912
integer taborder = 170
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Vessel Types"
end type

type gb_6 from groupbox within tp1
integer x = 37
integer y = 960
integer width = 1189
integer height = 496
integer taborder = 180
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Score && Rating Display Options"
end type

type gb_14 from groupbox within tp1
integer x = 37
integer y = 1488
integer width = 1193
integer height = 288
integer taborder = 200
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Application Folders"
end type

type gb_12 from groupbox within tp1
integer x = 2725
integer y = 32
integer width = 859
integer height = 912
integer taborder = 180
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Vessel Fleet Groups"
end type

type gb_16 from groupbox within tp1
integer x = 933
integer y = 32
integer width = 859
integer height = 912
integer taborder = 200
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Vetting Office"
end type

type gb_18 from groupbox within tp1
integer x = 37
integer y = 1792
integer width = 2139
integer height = 176
integer taborder = 180
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Report Footer"
end type

type gb_17 from groupbox within tp1
integer x = 1262
integer y = 960
integer width = 914
integer height = 816
integer taborder = 190
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "General Settings"
end type

type gb_21 from groupbox within tp1
integer x = 1829
integer y = 32
integer width = 859
integer height = 912
integer taborder = 70
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Vessel Rejection Reasons"
end type

type gb_22 from groupbox within tp1
integer x = 2213
integer y = 960
integer width = 1463
integer height = 1008
integer taborder = 190
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Red Flag Ports"
end type

type tp5 from userobject within tab_admin
event create ( )
event destroy ( )
integer x = 18
integer y = 112
integer width = 3712
integer height = 2000
long backcolor = 67108864
string text = "User Access"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
dw_dept dw_dept
cb_savedept cb_savedept
cb_deldept cb_deldept
cb_newdept cb_newdept
cbx_vims cbx_vims
cb_edituser cb_edituser
dw_users dw_users
sle_search sle_search
st_15 st_15
gb_3 gb_3
gb_4 gb_4
end type

on tp5.create
this.dw_dept=create dw_dept
this.cb_savedept=create cb_savedept
this.cb_deldept=create cb_deldept
this.cb_newdept=create cb_newdept
this.cbx_vims=create cbx_vims
this.cb_edituser=create cb_edituser
this.dw_users=create dw_users
this.sle_search=create sle_search
this.st_15=create st_15
this.gb_3=create gb_3
this.gb_4=create gb_4
this.Control[]={this.dw_dept,&
this.cb_savedept,&
this.cb_deldept,&
this.cb_newdept,&
this.cbx_vims,&
this.cb_edituser,&
this.dw_users,&
this.sle_search,&
this.st_15,&
this.gb_3,&
this.gb_4}
end on

on tp5.destroy
destroy(this.dw_dept)
destroy(this.cb_savedept)
destroy(this.cb_deldept)
destroy(this.cb_newdept)
destroy(this.cbx_vims)
destroy(this.cb_edituser)
destroy(this.dw_users)
destroy(this.sle_search)
destroy(this.st_15)
destroy(this.gb_3)
destroy(this.gb_4)
end on

type dw_dept from datawindow within tp5
integer x = 2066
integer y = 112
integer width = 1573
integer height = 1744
integer taborder = 190
string title = "none"
string dataobject = "d_sq_tb_dept"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event editchanged;
cb_Savedept.Enabled = True
end event

event itemchanged;Data = Trim(data)

If data = "Vetting" then 
	MessageBox("Department Name", "Cannot rename a department to this name.",Exclamation!)
	Return 2
End If

If dw_dept.GetItemNumber( row, "dept_id") = 1 then
	Messagebox("Department Name", "Cannot rename the Vetting department.",Exclamation!)
	Return 2
End If

cb_Savedept.Enabled = True




end event

event retrieveend;If (rowcount > 0) then cb_deldept.Enabled = True
end event

type cb_savedept from commandbutton within tp5
integer x = 3438
integer y = 1856
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;SetPointer (HourGlass!)

If dw_Dept.Update( ) = 1 then
	Messagebox ("Saved", "The Department table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Department table could not be saved successfully.",Exclamation!)
	dw_Dept.Retrieve( )
End If

Commit;

dw_users.Retrieve( )
end event

type cb_deldept from commandbutton within tp5
integer x = 2267
integer y = 1856
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
If dw_dept.GetItemNumber(dw_Dept.GetRow(), "dept_id") = 1 then
	Messagebox("Delete Error", "Cannot delete the Vetting Dept.", Exclamation!)
	Return
End If

dw_Dept.DeleteRow( dw_Dept.GetRow())

cb_SaveDept.Enabled = True

If dw_Dept.RowCount( ) = 0 then This.Enabled = False

end event

type cb_newdept from commandbutton within tp5
integer x = 2066
integer y = 1856
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_Dept.InsertRow(0)

If li_NewRow > 0 then
	dw_Dept.SetItem(li_NewRow, "Deptname", "<New Department>")
	cb_SaveDept.Enabled = True
	cb_DelDept.Enabled = True
	dw_Dept.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type cbx_vims from checkbox within tp5
integer x = 1646
integer y = 1872
integer width = 325
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "VIMS Only"
end type

event clicked;
If This.Checked then	dw_users.SetFilter( "Access > 0") else dw_users.SetFilter("")

dw_users.Filter()

end event

type cb_edituser from commandbutton within tp5
integer x = 73
integer y = 1856
integer width = 238
integer height = 80
integer taborder = 210
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Edit"
end type

event clicked;
String ls_UserID
Integer li_Found

ls_UserID = dw_Users.GetItemString(dw_Users.GetRow(), "UserID")

OpenWithParm(w_User, ls_UserID)

If Message.DoubleParm = 1 then 
	dw_Users.Retrieve()
	li_Found = dw_Users.Find("UserID='" +ls_UserID+ "'", 1, dw_Users.RowCount())
	If li_Found>0 then 
		dw_Users.SetRow(li_Found)
		dw_Users.ScrollToRow(li_Found)
	End If
End If
end event

type dw_users from datawindow within tp5
integer x = 73
integer y = 112
integer width = 1883
integer height = 1744
integer taborder = 200
string title = "none"
string dataobject = "d_sq_tb_users"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event clicked;string ls_sort

If (dwo.type = "text") then
	If (dwo.tag>"") then
		ls_sort = dwo.Tag
		this.setSort(ls_sort)
		this.Sort()
		if right(ls_sort,1) = "A" then 
			ls_sort = replace(ls_sort, len(ls_sort),1, "D")
		else
			ls_sort = replace(ls_sort, len(ls_sort),1, "A")
		end if
		dwo.Tag = ls_sort
	End If
end if

sle_Search.Text = ""
end event

event doubleclicked;
If row>0 then cb_EditUser.Event Clicked()

end event

event rowfocuschanged;
// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to refresh the row colors when using arrow keys to navigate
This.SetRedraw(True)


end event

type sle_search from singlelineedit within tp5
event ue_key pbm_keyup
integer x = 1591
integer y = 32
integer width = 361
integer height = 76
integer taborder = 60
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
integer limit = 20
borderstyle borderstyle = stylelowered!
end type

event ue_key;
Post wf_FindUser()
end event

type st_15 from statictext within tp5
integer x = 1445
integer y = 32
integer width = 146
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = " Find:"
boolean focusrectangle = false
end type

type gb_3 from groupbox within tp5
integer x = 37
integer y = 32
integer width = 1957
integer height = 1936
integer taborder = 60
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "User List"
end type

type gb_4 from groupbox within tp5
integer x = 2030
integer y = 32
integer width = 1646
integer height = 1936
integer taborder = 70
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Departments"
end type

type tp3 from userobject within tab_admin
integer x = 18
integer y = 112
integer width = 3712
integer height = 2000
long backcolor = 67108864
string text = "Inspections"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
em_mire em_mire
st_25 st_25
st_24 st_24
sle_pwd sle_pwd
st_21 st_21
sle_user sle_user
st_20 st_20
sle_acc sle_acc
st_19 st_19
lb_files lb_files
cb_check cb_check
cb_insp cb_insp
st_mng st_mng
st_super st_super
cbx_sire cbx_sire
htb_mng htb_mng
st_17 st_17
htb_super htb_super
st_16 st_16
st_14 st_14
htb_red htb_red
st_red st_red
st_yellow st_yellow
htb_yellow htb_yellow
st_1 st_1
cb_savemgmt cb_savemgmt
dw_mgmt dw_mgmt
cb_savec cb_savec
cb_delc cb_delc
cb_newc cb_newc
dw_cause dw_cause
cb_saver cb_saver
cb_delr cb_delr
cb_newr cb_newr
dw_resp dw_resp
cb_savesm cb_savesm
cb_delsm cb_delsm
cb_newsm cb_newsm
dw_sm dw_sm
gb_9 gb_9
gb_1 gb_1
gb_2 gb_2
gb_15 gb_15
gb_19 gb_19
gb_20 gb_20
gb_23 gb_23
gb_26 gb_26
end type

on tp3.create
this.em_mire=create em_mire
this.st_25=create st_25
this.st_24=create st_24
this.sle_pwd=create sle_pwd
this.st_21=create st_21
this.sle_user=create sle_user
this.st_20=create st_20
this.sle_acc=create sle_acc
this.st_19=create st_19
this.lb_files=create lb_files
this.cb_check=create cb_check
this.cb_insp=create cb_insp
this.st_mng=create st_mng
this.st_super=create st_super
this.cbx_sire=create cbx_sire
this.htb_mng=create htb_mng
this.st_17=create st_17
this.htb_super=create htb_super
this.st_16=create st_16
this.st_14=create st_14
this.htb_red=create htb_red
this.st_red=create st_red
this.st_yellow=create st_yellow
this.htb_yellow=create htb_yellow
this.st_1=create st_1
this.cb_savemgmt=create cb_savemgmt
this.dw_mgmt=create dw_mgmt
this.cb_savec=create cb_savec
this.cb_delc=create cb_delc
this.cb_newc=create cb_newc
this.dw_cause=create dw_cause
this.cb_saver=create cb_saver
this.cb_delr=create cb_delr
this.cb_newr=create cb_newr
this.dw_resp=create dw_resp
this.cb_savesm=create cb_savesm
this.cb_delsm=create cb_delsm
this.cb_newsm=create cb_newsm
this.dw_sm=create dw_sm
this.gb_9=create gb_9
this.gb_1=create gb_1
this.gb_2=create gb_2
this.gb_15=create gb_15
this.gb_19=create gb_19
this.gb_20=create gb_20
this.gb_23=create gb_23
this.gb_26=create gb_26
this.Control[]={this.em_mire,&
this.st_25,&
this.st_24,&
this.sle_pwd,&
this.st_21,&
this.sle_user,&
this.st_20,&
this.sle_acc,&
this.st_19,&
this.lb_files,&
this.cb_check,&
this.cb_insp,&
this.st_mng,&
this.st_super,&
this.cbx_sire,&
this.htb_mng,&
this.st_17,&
this.htb_super,&
this.st_16,&
this.st_14,&
this.htb_red,&
this.st_red,&
this.st_yellow,&
this.htb_yellow,&
this.st_1,&
this.cb_savemgmt,&
this.dw_mgmt,&
this.cb_savec,&
this.cb_delc,&
this.cb_newc,&
this.dw_cause,&
this.cb_saver,&
this.cb_delr,&
this.cb_newr,&
this.dw_resp,&
this.cb_savesm,&
this.cb_delsm,&
this.cb_newsm,&
this.dw_sm,&
this.gb_9,&
this.gb_1,&
this.gb_2,&
this.gb_15,&
this.gb_19,&
this.gb_20,&
this.gb_23,&
this.gb_26}
end on

on tp3.destroy
destroy(this.em_mire)
destroy(this.st_25)
destroy(this.st_24)
destroy(this.sle_pwd)
destroy(this.st_21)
destroy(this.sle_user)
destroy(this.st_20)
destroy(this.sle_acc)
destroy(this.st_19)
destroy(this.lb_files)
destroy(this.cb_check)
destroy(this.cb_insp)
destroy(this.st_mng)
destroy(this.st_super)
destroy(this.cbx_sire)
destroy(this.htb_mng)
destroy(this.st_17)
destroy(this.htb_super)
destroy(this.st_16)
destroy(this.st_14)
destroy(this.htb_red)
destroy(this.st_red)
destroy(this.st_yellow)
destroy(this.htb_yellow)
destroy(this.st_1)
destroy(this.cb_savemgmt)
destroy(this.dw_mgmt)
destroy(this.cb_savec)
destroy(this.cb_delc)
destroy(this.cb_newc)
destroy(this.dw_cause)
destroy(this.cb_saver)
destroy(this.cb_delr)
destroy(this.cb_newr)
destroy(this.dw_resp)
destroy(this.cb_savesm)
destroy(this.cb_delsm)
destroy(this.cb_newsm)
destroy(this.dw_sm)
destroy(this.gb_9)
destroy(this.gb_1)
destroy(this.gb_2)
destroy(this.gb_15)
destroy(this.gb_19)
destroy(this.gb_20)
destroy(this.gb_23)
destroy(this.gb_26)
end on

type em_mire from editmask within tp3
integer x = 3365
integer y = 912
integer width = 183
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
string text = "0"
alignment alignment = right!
borderstyle borderstyle = stylelowered!
string mask = "##0"
boolean spin = true
double increment = 1
string minmax = "1~~50"
end type

type st_25 from statictext within tp3
integer x = 3566
integer y = 928
integer width = 91
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "obs"
boolean focusrectangle = false
end type

type st_24 from statictext within tp3
integer x = 2944
integer y = 928
integer width = 411
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Notify if less than:"
boolean focusrectangle = false
end type

type sle_pwd from singlelineedit within tp3
integer x = 3291
integer y = 1424
integer width = 343
integer height = 76
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
boolean password = true
integer limit = 10
borderstyle borderstyle = stylelowered!
end type

type st_21 from statictext within tp3
integer x = 3035
integer y = 1440
integer width = 238
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Password:"
boolean focusrectangle = false
end type

type sle_user from singlelineedit within tp3
integer x = 3291
integer y = 1312
integer width = 343
integer height = 76
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
integer limit = 10
borderstyle borderstyle = stylelowered!
end type

type st_20 from statictext within tp3
integer x = 3035
integer y = 1328
integer width = 238
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "User ID:"
boolean focusrectangle = false
end type

type sle_acc from singlelineedit within tp3
integer x = 3291
integer y = 1200
integer width = 343
integer height = 76
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
integer limit = 10
borderstyle borderstyle = stylelowered!
end type

type st_19 from statictext within tp3
integer x = 3035
integer y = 1216
integer width = 238
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Account:"
boolean focusrectangle = false
end type

type lb_files from listbox within tp3
boolean visible = false
integer x = 567
integer y = 1024
integer width = 274
integer height = 96
integer taborder = 240
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

type cb_check from commandbutton within tp3
integer x = 2999
integer y = 1728
integer width = 695
integer height = 112
integer taborder = 200
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Check Incoming"
end type

event clicked;
If g_Obj.Developer and Upper(SQLCA.Servername) = guo_Global.is_ProductionServer then Return

If SQLCA.Database = guo_Global.is_ProductionDB then Post wf_checkincoming("R:\Down\AUTO2.01.GLSSRV1.APMOLLER.NET\CPHVIMS\") Else Post wf_checkincoming("C:\VIMS_Incoming\")

end event

type cb_insp from commandbutton within tp3
integer x = 2999
integer y = 1856
integer width = 695
integer height = 112
integer taborder = 250
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Inspector Name Cleanup"
end type

event clicked;
Open(w_InspectorCleanup)
end event

type st_mng from statictext within tp3
integer x = 2944
integer y = 720
integer width = 709
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "0 days after due date"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_super from statictext within tp3
integer x = 2944
integer y = 416
integer width = 709
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "0 days after due date"
alignment alignment = center!
boolean focusrectangle = false
end type

type cbx_sire from checkbox within tp3
integer x = 2944
integer y = 96
integer width = 695
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Enable Email Notification"
end type

event clicked;
String ls_Setting

If this.Checked Then ls_Setting = "1" Else ls_Setting = "0"

f_Config("SREM", ls_Setting, 1)
end event

type htb_mng from htrackbar within tp3
integer x = 2926
integer y = 576
integer width = 731
integer height = 144
integer maxposition = 60
integer tickfrequency = 10
integer pagesize = 5
htickmarks tickmarks = hticksontop!
end type

event moved;wf_SetScrollText(scrollpos, 3)
end event

event lineleft;wf_SetScrollText(This.Position, 3)
end event

event lineright;wf_SetScrollText(This.Position, 3)
end event

event pageleft;wf_SetScrollText(This.Position, 3)
end event

event pageright;wf_SetScrollText(This.Position, 3)
end event

type st_17 from statictext within tp3
integer x = 2944
integer y = 512
integer width = 585
integer height = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean underline = true
long textcolor = 33554432
long backcolor = 67108864
string text = "Email to Managers:"
boolean focusrectangle = false
end type

type htb_super from htrackbar within tp3
integer x = 2926
integer y = 272
integer width = 731
integer height = 144
integer maxposition = 60
integer tickfrequency = 10
integer pagesize = 5
htickmarks tickmarks = hticksontop!
end type

event moved;
wf_SetScrollText(scrollpos, 2)
end event

event lineleft;wf_SetScrollText(This.Position, 2)
end event

event lineright;wf_SetScrollText(This.Position, 2)
end event

event pageleft;wf_SetScrollText(This.Position, 2)
end event

event pageright;wf_SetScrollText(This.Position, 2)
end event

type st_16 from statictext within tp3
integer x = 2944
integer y = 208
integer width = 585
integer height = 68
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean underline = true
long textcolor = 33554432
long backcolor = 67108864
string text = "Email to Superintendent:"
boolean focusrectangle = false
end type

type st_14 from statictext within tp3
integer x = 2176
integer y = 1552
integer width = 384
integer height = 60
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 255
string text = " Red Status:"
boolean focusrectangle = false
end type

type htb_red from htrackbar within tp3
integer x = 2158
integer y = 1632
integer width = 786
integer height = 144
integer minposition = -6
integer maxposition = 6
integer tickfrequency = 1
integer pagesize = 3
htickmarks tickmarks = hticksontop!
end type

event lineleft;
wf_SetScrollText(This.Position, 0)
end event

event lineright;
wf_SetScrollText(This.Position, 0)
end event

event pageleft;
wf_SetScrollText(This.Position, 0)
end event

event pageright;
wf_SetScrollText(This.Position, 0)
end event

event moved;
wf_SetScrollText(scrollpos, 0)
end event

type st_red from statictext within tp3
integer x = 2194
integer y = 1776
integer width = 709
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "0 months before due date"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_yellow from statictext within tp3
integer x = 2194
integer y = 1424
integer width = 709
integer height = 52
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "0 months before due date"
alignment alignment = center!
boolean focusrectangle = false
end type

type htb_yellow from htrackbar within tp3
integer x = 2158
integer y = 1280
integer width = 786
integer height = 144
integer minposition = -6
integer maxposition = 6
integer tickfrequency = 1
integer pagesize = 3
htickmarks tickmarks = hticksontop!
end type

event moved;
wf_SetScrollText(scrollpos, 1)
end event

event lineleft;
wf_SetScrollText(This.Position, 1)
end event

event lineright;
wf_SetScrollText(This.Position, 1)
end event

event pageleft;
wf_SetScrollText(This.Position, 1)
end event

event pageright;
wf_SetScrollText(This.Position, 1)
end event

type st_1 from statictext within tp3
integer x = 2176
integer y = 1200
integer width = 389
integer height = 60
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 65535
string text = " Yellow Status:"
boolean focusrectangle = false
end type

type cb_savemgmt from commandbutton within tp3
integer x = 1865
integer y = 1872
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;
SetPointer (HourGlass!)

If dw_Mgmt.Update( ) = 1 then
	Messagebox ("Saved", "The Management Notification table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Management Notification table could not be saved successfully.",Exclamation!)
End If

Commit;

dw_Mgmt.Retrieve( )

end event

type dw_mgmt from datawindow within tp3
integer x = 55
integer y = 1152
integer width = 2011
integer height = 720
integer taborder = 230
string title = "none"
string dataobject = "d_sq_tb_mgmtnotify"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;
cb_savemgmt.Enabled = True
end event

event editchanged;
cb_savemgmt.Enabled = True
end event

type cb_savec from commandbutton within tp3
integer x = 2633
integer y = 944
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;SetPointer (HourGlass!)
String ls_Data

If g_Obj.DBModif = 0 then
	If Messagebox("Confirm Changes", "Any changes to this table will require a database update to be issued for VIMS Mobile. ~n~nAre you sure you want to save?", Question!, YesNo!) = 2 then Return
End If

If dw_Cause.Update( ) = 1 then	
	Messagebox ("Saved", "The Cause table was updated successfully.")
	This.Enabled = False
	If g_obj.DBModif = 0 then  // Check if DB is not modified
		ls_Data = "1"
		If f_Config("DBST", ls_Data, 1) = 0 then
			g_Obj.DBModif = 1
			w_setdbstatus(g_Obj.DBModif)
		End If
	End If
Else
	Messagebox ("Save Error", "The Cause table could not be saved successfully.",Exclamation!)
	dw_Cause.Retrieve( )
End If

Commit;
end event

type cb_delc from commandbutton within tp3
integer x = 2322
integer y = 944
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
If MessageBox("Confirm Delete", "Deleting from this table may cause serious synchronization problems with VIMS Client programs.~n~nAre you absolutely sure you want to delete this item?", Question!, YesNo!) = 2 then Return

dw_Cause.DeleteRow( dw_Cause.GetRow())

cb_SaveC.Enabled = True

If dw_Cause.RowCount( ) = 0 then This.Enabled = False

end event

type cb_newc from commandbutton within tp3
integer x = 2121
integer y = 944
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_Cause.InsertRow(0)

If li_NewRow > 0 then
	dw_Cause.SetItem(li_NewRow, "Causetext", "<New Item>")
	cb_SaveC.Enabled = True
	cb_DelC.Enabled = True
	dw_Cause.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type dw_cause from datawindow within tp3
integer x = 2121
integer y = 96
integer width = 713
integer height = 848
integer taborder = 160
string title = "none"
string dataobject = "d_sq_tb_cause"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event editchanged;
cb_Savec.Enabled = True
end event

event retrieveend;
If (rowcount > 0) then cb_delc.Enabled = True
end event

type cb_saver from commandbutton within tp3
integer x = 1810
integer y = 944
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;Integer li_Count
String ls_Data

If g_Obj.DBModif = 0 then
	If Messagebox("Confirm Changes", "Any changes to this table will require a database update to be issued for VIMS Mobile. ~n~nAre you sure you want to save?", Question!, YesNo!) = 2 then Return
End If

SetPointer (HourGlass!)

If dw_resp.Update( ) = 1 then
	Messagebox ("Saved", "The Responsibility table was updated successfully. ")
	This.Enabled = False
	If g_obj.DBModif = 0 then  // Check if DB is not modified
		ls_Data = "1"
		If f_Config("DBST", ls_Data, 1) = 0 then
			g_Obj.DBModif = 1
			w_setdbstatus(g_Obj.DBModif)
		End If
	End If
Else
	Messagebox ("Save Error", "The Responsibility table could not be saved successfully.",Exclamation!)
End If

Commit;

dw_Resp.Retrieve( )
tab_admin.tp5.dw_users.Retrieve( )
end event

type cb_delr from commandbutton within tp3
integer x = 1499
integer y = 944
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
If MessageBox("Confirm Delete", "Deleting from this table may cause serious synchronization problems with VIMS Client programs.~n~nAre you absolutely sure you want to delete this item?", Question!, YesNo!) = 2 then Return

dw_Resp.DeleteRow( dw_Resp.GetRow())

cb_SaveR.Enabled = True

If dw_Resp.RowCount( ) = 0 then This.Enabled = False

end event

type cb_newr from commandbutton within tp3
integer x = 1298
integer y = 944
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_resp.InsertRow(0)

If li_NewRow > 0 then
	dw_resp.SetItem(li_NewRow, "Resptext", "<New Item>")
	cb_SaveR.Enabled = True
	cb_DelR.Enabled = True
	dw_resp.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type dw_resp from datawindow within tp3
integer x = 1298
integer y = 96
integer width = 713
integer height = 848
integer taborder = 160
string title = "none"
string dataobject = "d_sq_tb_resp"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event editchanged;
cb_Saver.Enabled = True
end event

event retrieveend;
If (rowcount > 0) then cb_delr.Enabled = True


end event

type cb_savesm from commandbutton within tp3
integer x = 987
integer y = 944
integer width = 201
integer height = 80
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;Integer li_Count
String ls_Data

If g_Obj.DBModif = 0 then
	If Messagebox("Confirm Changes", "Any changes to this table will require a database update to be issued for VIMS Mobile. ~n~nAre you sure you want to save?", Question!, YesNo!) = 2 then Return
End If

SetPointer (HourGlass!)

If dw_SM.Update( ) = 1 then
	Messagebox ("Saved", "The Summary Type table was updated successfully.")
	This.Enabled = False
	If g_obj.DBModif = 0 then  // Check if DB is not modified
		ls_Data = "1"
		If f_Config("DBST", ls_Data, 1) = 0 then
			g_Obj.DBModif = 1
			w_setdbstatus(g_Obj.DBModif)
		End If
	End If
Else
	Messagebox ("Save Error", "The Summary Type table could not be saved successfully.",Exclamation!)
End If

Commit;

dw_SM.Retrieve( )

end event

type cb_delsm from commandbutton within tp3
integer x = 256
integer y = 944
integer width = 201
integer height = 80
integer taborder = 220
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
If MessageBox("Confirm Delete", "Deleting from this table may cause SERIOUS synchronization problems with VIMS Client programs.~n~nAre you absolutely sure you want to delete this item?", Question!, YesNo!) = 2 then Return

dw_SM.DeleteRow( dw_SM.GetRow())

cb_SaveSM.Enabled = True

If dw_SM.RowCount( ) = 0 then	This.Enabled = False

end event

type cb_newsm from commandbutton within tp3
integer x = 55
integer y = 944
integer width = 201
integer height = 80
integer taborder = 210
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_SM.InsertRow(0)

If li_NewRow > 0 then
	dw_SM.SetItem(li_NewRow, "SM_Name", "<New Type>")
	cb_SaveSM.Enabled = True
	cb_DelSM.Enabled = True
	dw_SM.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type dw_sm from datawindow within tp3
integer x = 55
integer y = 96
integer width = 1134
integer height = 848
integer taborder = 180
string title = "none"
string dataobject = "d_sq_tb_summarytypes"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;
cb_Savesm.Enabled = True
end event

event retrieveend;
If (rowcount > 0) then cb_delsm.Enabled = True

end event

type gb_9 from groupbox within tp3
integer x = 18
integer y = 16
integer width = 1207
integer height = 1024
integer taborder = 170
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Inspection Summary Types"
end type

type gb_1 from groupbox within tp3
integer x = 1262
integer y = 16
integer width = 786
integer height = 1024
integer taborder = 160
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Responsibility"
end type

type gb_2 from groupbox within tp3
integer x = 2085
integer y = 16
integer width = 786
integer height = 1024
integer taborder = 170
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Causes"
end type

type gb_15 from groupbox within tp3
integer x = 18
integer y = 1088
integer width = 2085
integer height = 880
integer taborder = 180
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Management Notification"
end type

type gb_19 from groupbox within tp3
integer x = 2139
integer y = 1088
integer width = 823
integer height = 880
integer taborder = 180
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Inspection Due Dates"
end type

type gb_20 from groupbox within tp3
integer x = 2907
integer y = 16
integer width = 768
integer height = 784
integer taborder = 180
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "SIRE Overdue Emails"
end type

type gb_23 from groupbox within tp3
integer x = 2907
integer y = 832
integer width = 768
integer height = 208
integer taborder = 190
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "MIRE Low Obs Notification"
end type

type gb_26 from groupbox within tp3
integer x = 2999
integer y = 1088
integer width = 677
integer height = 608
integer taborder = 190
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "OCIMF Web Service"
end type

type tp2 from userobject within tab_admin
integer x = 18
integer y = 112
integer width = 3712
integer height = 2000
long backcolor = 67108864
string text = "Planning"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
cb_offset cb_offset
cb_savemodelcal cb_savemodelcal
dw_inspmodel dw_inspmodel
cb_clear cb_clear
cb_save cb_save
cb_edit cb_edit
cb_savetask cb_savetask
cb_deltask cb_deltask
cb_newtask cb_newtask
dw_task dw_task
cb_remone cb_remone
cb_getone cb_getone
cb_remall cb_remall
cb_getall cb_getall
st_6 st_6
dw_unlink dw_unlink
dw_link dw_link
st_5 st_5
st_4 st_4
dw_utype dw_utype
gb_7 gb_7
gb_8 gb_8
gb_10 gb_10
end type

on tp2.create
this.cb_offset=create cb_offset
this.cb_savemodelcal=create cb_savemodelcal
this.dw_inspmodel=create dw_inspmodel
this.cb_clear=create cb_clear
this.cb_save=create cb_save
this.cb_edit=create cb_edit
this.cb_savetask=create cb_savetask
this.cb_deltask=create cb_deltask
this.cb_newtask=create cb_newtask
this.dw_task=create dw_task
this.cb_remone=create cb_remone
this.cb_getone=create cb_getone
this.cb_remall=create cb_remall
this.cb_getall=create cb_getall
this.st_6=create st_6
this.dw_unlink=create dw_unlink
this.dw_link=create dw_link
this.st_5=create st_5
this.st_4=create st_4
this.dw_utype=create dw_utype
this.gb_7=create gb_7
this.gb_8=create gb_8
this.gb_10=create gb_10
this.Control[]={this.cb_offset,&
this.cb_savemodelcal,&
this.dw_inspmodel,&
this.cb_clear,&
this.cb_save,&
this.cb_edit,&
this.cb_savetask,&
this.cb_deltask,&
this.cb_newtask,&
this.dw_task,&
this.cb_remone,&
this.cb_getone,&
this.cb_remall,&
this.cb_getall,&
this.st_6,&
this.dw_unlink,&
this.dw_link,&
this.st_5,&
this.st_4,&
this.dw_utype,&
this.gb_7,&
this.gb_8,&
this.gb_10}
end on

on tp2.destroy
destroy(this.cb_offset)
destroy(this.cb_savemodelcal)
destroy(this.dw_inspmodel)
destroy(this.cb_clear)
destroy(this.cb_save)
destroy(this.cb_edit)
destroy(this.cb_savetask)
destroy(this.cb_deltask)
destroy(this.cb_newtask)
destroy(this.dw_task)
destroy(this.cb_remone)
destroy(this.cb_getone)
destroy(this.cb_remall)
destroy(this.cb_getall)
destroy(this.st_6)
destroy(this.dw_unlink)
destroy(this.dw_link)
destroy(this.st_5)
destroy(this.st_4)
destroy(this.dw_utype)
destroy(this.gb_7)
destroy(this.gb_8)
destroy(this.gb_10)
end on

type cb_offset from commandbutton within tp2
integer x = 933
integer y = 944
integer width = 439
integer height = 80
integer taborder = 190
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Offset Days..."
end type

event clicked;
g_obj.objstring = dw_utype.GetItemString(dw_utype.GetRow(), "userid")

open(w_offset)
end event

type cb_savemodelcal from commandbutton within tp2
integer x = 3456
integer y = 1888
integer width = 201
integer height = 80
integer taborder = 210
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;
Integer li_Count

SetPointer (HourGlass!)

If dw_inspmodel.Update( ) = 1 then
	Messagebox ("Saved", "The Vessel Inspection Calendar table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Vessel Inspection Calendar table could not be saved successfully.",Exclamation!)
	dw_inspmodel.Retrieve( )
End If

Commit;


end event

type dw_inspmodel from datawindow within tp2
integer x = 1792
integer y = 1136
integer width = 1865
integer height = 752
integer taborder = 220
string title = "none"
string dataobject = "d_sq_tb_modelcalselect"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event editchanged;
cb_SaveModelCal.Enabled = True
end event

event itemchanged;
cb_SaveModelCal.Enabled = True
end event

type cb_clear from commandbutton within tp2
integer x = 494
integer y = 944
integer width = 439
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Clear Details"
end type

event clicked;DateTime ldt_Null
Integer li_Null

SetNull(li_Null)
SetNull(ldt_Null)

cb_Save.Enabled = True
dw_utype.SetItem(dw_uType.GetRow(), "workdays", li_Null)
dw_utype.SetItem(dw_uType.GetRow(), "startdate", ldt_Null)

end event

type cb_save from commandbutton within tp2
integer x = 2011
integer y = 944
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;Integer li_Count

SetPointer (HourGlass!)

If dw_uType.Update( ) = 1 then
	Messagebox ("Saved", "The table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The table could not be saved successfully.",Exclamation!)
	Return
End If

Commit;

end event

type cb_edit from commandbutton within tp2
integer x = 55
integer y = 944
integer width = 439
integer height = 80
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Edit Details..."
end type

event clicked;
g_obj.objstring = dw_utype.GetItemString(dw_utype.GetRow(), "fullname")

g_obj.noteid = dw_utype.GetItemNumber(dw_utype.GetRow(), "workdays")

g_obj.sql = String(dw_utype.GetItemDateTime(dw_utype.GetRow(), "startdate"), "yyyy-mm-dd")

open(w_userdetail)

If g_obj.Noteid > 0 then
	cb_Save.Enabled = True
	dw_utype.SetItem(dw_uType.GetRow(), "workdays", g_obj.noteid)
	dw_utype.SetItem(dw_uType.GetRow(), "startdate", DateTime(Date(g_obj.sql)))
End If
end event

type cb_savetask from commandbutton within tp2
integer x = 1481
integer y = 1888
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Save"
end type

event clicked;Integer li_Count

SetPointer (HourGlass!)

If dw_task.Update( ) = 1 then
	Messagebox ("Saved", "The Task table was updated successfully.")
	This.Enabled = False
Else
	Messagebox ("Save Error", "The Task table could not be saved successfully.",Exclamation!)
End If

Commit;

dw_Task.Retrieve( )

end event

type cb_deltask from commandbutton within tp2
integer x = 256
integer y = 1888
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "Del"
end type

event clicked;
dw_Task.DeleteRow( dw_Task.GetRow())

cb_Savetask.Enabled = True

If dw_task.RowCount( ) = 0 then This.Enabled = False

end event

type cb_newtask from commandbutton within tp2
integer x = 55
integer y = 1888
integer width = 201
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "New"
end type

event clicked;
Integer li_NewRow

li_NewRow = dw_task.InsertRow(0)

If li_NewRow > 0 then
	dw_task.SetItem(li_NewRow, "taskname", "<New Task>")
	dw_task.SetItem(li_NewRow, "istask", 1)
	dw_task.SetItem(li_NewRow, "points", 1)
	dw_task.SetItem(li_NewRow, "color", 536870912)
	cb_SaveTask.Enabled = True
	cb_DelTask.Enabled = True
	dw_task.ScrollToRow(li_NewRow)
Else
	MessageBox("Error","DW Insert Error")
End If
end event

type dw_task from datawindow within tp2
integer x = 55
integer y = 1136
integer width = 1627
integer height = 752
integer taborder = 210
string title = "none"
string dataobject = "d_sq_tb_tasktypes"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;cb_SaveTask.Enabled = True
end event

event editchanged;cb_SaveTask.Enabled = True
end event

event retrieveend;
If rowcount > 0 then cb_deltask.Enabled = True Else cb_deltask.Enabled = False
end event

event rowfocuschanged;
// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to refresh the row colors when using arrow keys to navigate
This.SetRedraw(False)
This.SetRedraw(True)
end event

type cb_remone from commandbutton within tp2
integer x = 2853
integer y = 656
integer width = 201
integer height = 80
integer taborder = 190
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = ">"
end type

event clicked;Integer li_TypeID
String ls_UserID


li_TypeID = w_admin.tab_admin.tp2.dw_link.GetItemNumber(w_admin.tab_admin.tp2.dw_link.GetRow(), "Type_ID")
ls_UserID = w_admin.tab_admin.tp2.dw_utype.GetItemString(w_admin.tab_admin.tp2.dw_utype.GetRow(), "UserID")

//Insert Into VETT_USERCAP (USER_ID, TYPE_ID) Values (:ls_UserID, :li_TypeID);

Delete From VETT_USERCAP Where (USER_ID = :ls_UserID) and (TYPE_ID = :li_TypeID);

If SQLCA.SQLCode <> 0 then
	Messagebox("DB Error", "Could not remove vessel type.~n~n" + SQLCA.SQLErrtext, Exclamation!)
	Rollback;
Else
	Commit;
End If

w_admin.tab_admin.tp2.dw_utype.SetItem( w_admin.tab_admin.tp2.dw_utype.GetRow(), "TypeCount", w_admin.tab_admin.tp2.dw_link.Retrieve(ls_UserID))
w_admin.tab_admin.tp2.dw_unlink.Retrieve(ls_UserID)
end event

type cb_getone from commandbutton within tp2
integer x = 2853
integer y = 440
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "<"
end type

event clicked;Integer li_TypeID
String ls_UserID

li_TypeID = w_admin.tab_admin.tp2.dw_unlink.GetItemNumber(w_admin.tab_admin.tp2.dw_unlink.GetRow(), "Type_ID")
ls_UserID = w_admin.tab_admin.tp2.dw_utype.GetItemString(w_admin.tab_admin.tp2.dw_utype.GetRow(), "UserID")

Insert Into VETT_USERCAP (USER_ID, TYPE_ID) Values (:ls_UserID, :li_TypeID);

If SQLCA.SQLCode <> 0 then
	Messagebox("DB Error", "Could not assign vessel type.~n~n" + SQLCA.SQLErrtext, Exclamation!)
	Rollback;
Else
	Commit;
End If

w_admin.tab_admin.tp2.dw_utype.SetItem( w_admin.tab_admin.tp2.dw_utype.GetRow(), "TypeCount", w_admin.tab_admin.tp2.dw_link.Retrieve(ls_UserID))
w_admin.tab_admin.tp2.dw_unlink.Retrieve(ls_UserID)
end event

type cb_remall from commandbutton within tp2
integer x = 2853
integer y = 752
integer width = 201
integer height = 80
integer taborder = 180
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = ">>>"
end type

event clicked;Integer li_TypeID, li_Count
String ls_UserID

ls_UserID = w_admin.tab_admin.tp2.dw_utype.GetItemString(w_admin.tab_admin.tp2.dw_utype.GetRow(), "UserID")

For li_Count = 1 to w_admin.tab_admin.tp2.dw_link.RowCount( )
	
	li_TypeID = w_admin.tab_admin.tp2.dw_link.GetItemNumber(li_Count, "Type_ID")
	Delete From VETT_USERCAP Where (USER_ID = :ls_UserID) and (TYPE_ID = :li_TypeID);
	
	If SQLCA.SQLCode <> 0 then
		Messagebox("DB Error", "Could not assign one or more vessel types.~n~n" + SQLCA.SQLErrtext, Exclamation!)
		Rollback;
		Exit
	Else
		Commit;
	End If
Next

w_admin.tab_admin.tp2.dw_utype.SetItem( w_admin.tab_admin.tp2.dw_utype.GetRow(), "TypeCount", w_admin.tab_admin.tp2.dw_link.Retrieve(ls_UserID))
w_admin.tab_admin.tp2.dw_unlink.Retrieve(ls_UserID)
end event

type cb_getall from commandbutton within tp2
integer x = 2853
integer y = 336
integer width = 201
integer height = 80
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
boolean enabled = false
string text = "<<<"
end type

event clicked;Integer li_TypeID, li_Count
String ls_UserID

ls_UserID = w_admin.tab_admin.tp2.dw_utype.GetItemString(w_admin.tab_admin.tp2.dw_utype.GetRow(), "UserID")

For li_Count = 1 to w_admin.tab_admin.tp2.dw_unlink.RowCount( )
	
	li_TypeID = w_admin.tab_admin.tp2.dw_unlink.GetItemNumber(li_Count, "Type_ID")
	Insert Into VETT_USERCAP (USER_ID, TYPE_ID) Values (:ls_UserID, :li_TypeID);	
	
	If SQLCA.SQLCode <> 0 then
		Messagebox("DB Error", "Could not assign one or more vessel types.~n~n" + SQLCA.SQLErrtext, Exclamation!)
		Rollback;
		Exit
	Else
		Commit;
	End If
Next

w_admin.tab_admin.tp2.dw_utype.SetItem( w_admin.tab_admin.tp2.dw_utype.GetRow(), "TypeCount", w_admin.tab_admin.tp2.dw_link.Retrieve(ls_UserID))
w_admin.tab_admin.tp2.dw_unlink.Retrieve(ls_UserID)
end event

type st_6 from statictext within tp2
integer x = 3072
integer y = 96
integer width = 439
integer height = 64
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Not Assigned:"
boolean focusrectangle = false
end type

type dw_unlink from datawindow within tp2
integer x = 3072
integer y = 160
integer width = 585
integer height = 848
integer taborder = 170
string title = "none"
string dataobject = "d_sq_tb_notuservetttype"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event retrieveend;
If rowcount = 0 then
	w_admin.tab_admin.tp2.cb_getall.Enabled = False
	w_admin.tab_admin.tp2.cb_getone.Enabled = False
Else
	w_admin.tab_admin.tp2.cb_getall.Enabled = True
	w_admin.tab_admin.tp2.cb_getone.Enabled = True
End If
end event

event rowfocuschanged;
// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to refresh the row colors when using arrow keys to navigate
This.SetRedraw(False)
This.SetRedraw(True)
end event

type dw_link from datawindow within tp2
integer x = 2249
integer y = 160
integer width = 585
integer height = 848
integer taborder = 160
string title = "none"
string dataobject = "d_sq_tb_uservetttype"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event retrieveend;
If rowcount = 0 then
	w_admin.tab_admin.tp2.cb_remall.Enabled = False
	w_admin.tab_admin.tp2.cb_remone.Enabled = False
Else
	w_admin.tab_admin.tp2.cb_remall.Enabled = True
	w_admin.tab_admin.tp2.cb_remone.Enabled = True
End If
end event

event rowfocuschanged;// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to refresh the row colors when using arrow keys to navigate
This.SetRedraw(False)
This.SetRedraw(True)
end event

type st_5 from statictext within tp2
integer x = 2249
integer y = 96
integer width = 494
integer height = 64
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Assigned Types:"
boolean focusrectangle = false
end type

type st_4 from statictext within tp2
integer x = 55
integer y = 96
integer width = 402
integer height = 64
integer textsize = -10
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "User List:"
boolean focusrectangle = false
end type

type dw_utype from datawindow within tp2
integer x = 55
integer y = 160
integer width = 2158
integer height = 784
integer taborder = 170
string title = "none"
string dataobject = "d_sq_tb_inspectors"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event rowfocuschanged;
w_admin.tab_admin.tp2.dw_link.Retrieve( This.GetItemString(GetRow(), "userid") )
w_admin.tab_admin.tp2.dw_unlink.Retrieve( This.GetItemString(GetRow(), "userid") )

// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to refresh the row colors when using arrow keys to navigate
This.SetRedraw(False)
This.SetRedraw(True)
end event

event clicked;string ls_sort

If (dwo.type = "text") then
	If (dwo.tag>"") then
		ls_sort = dwo.Tag
		this.setSort(ls_sort)
		this.Sort()
		if right(ls_sort,1) = "A" then 
			ls_sort = replace(ls_sort, len(ls_sort),1, "D")
		else
			ls_sort = replace(ls_sort, len(ls_sort),1, "A")
		end if
		dwo.Tag = ls_sort
	End If
End if

end event

event retrieveend;
If rowcount > 0 then cb_Edit.Enabled = True else cb_Edit.Enabled = False
end event

event doubleclicked;
If (row > 0) and (cb_edit.Enabled) then cb_edit.PostEvent(Clicked!)
end event

type gb_7 from groupbox within tp2
integer x = 18
integer y = 16
integer width = 3675
integer height = 1024
integer taborder = 170
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "User~'s Inspection Capability"
end type

type gb_8 from groupbox within tp2
integer x = 18
integer y = 1056
integer width = 1701
integer height = 928
integer taborder = 200
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Task List"
end type

type gb_10 from groupbox within tp2
integer x = 1755
integer y = 1056
integer width = 1938
integer height = 928
integer taborder = 210
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Vessel Inspection Calendar"
end type

type tp6 from userobject within tab_admin
integer x = 18
integer y = 112
integer width = 3712
integer height = 2000
long backcolor = 67108864
string text = "Vessels"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
cb_clearbox cb_clearbox
cbx_invims cbx_invims
cbx_sn cbx_sn
cbx_rep cbx_rep
cbx_tract cbx_tract
sle_vfind sle_vfind
st_22 st_22
dw_vslall dw_vslall
gb_24 gb_24
end type

on tp6.create
this.cb_clearbox=create cb_clearbox
this.cbx_invims=create cbx_invims
this.cbx_sn=create cbx_sn
this.cbx_rep=create cbx_rep
this.cbx_tract=create cbx_tract
this.sle_vfind=create sle_vfind
this.st_22=create st_22
this.dw_vslall=create dw_vslall
this.gb_24=create gb_24
this.Control[]={this.cb_clearbox,&
this.cbx_invims,&
this.cbx_sn,&
this.cbx_rep,&
this.cbx_tract,&
this.sle_vfind,&
this.st_22,&
this.dw_vslall,&
this.gb_24}
end on

on tp6.destroy
destroy(this.cb_clearbox)
destroy(this.cbx_invims)
destroy(this.cbx_sn)
destroy(this.cbx_rep)
destroy(this.cbx_tract)
destroy(this.sle_vfind)
destroy(this.st_22)
destroy(this.dw_vslall)
destroy(this.gb_24)
end on

type cb_clearbox from commandbutton within tp6
integer x = 951
integer y = 80
integer width = 165
integer height = 80
integer taborder = 210
integer textsize = -7
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Small Fonts"
string text = "Clear"
end type

event clicked;
sle_VFind.Text=""
wf_FilterVsl()

end event

type cbx_invims from checkbox within tp6
integer x = 2889
integer y = 80
integer width = 238
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "VIMS"
end type

event clicked;
wf_FilterVsl()
end event

type cbx_sn from checkbox within tp6
integer x = 2304
integer y = 80
integer width = 494
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "ShipNet Interface"
end type

event clicked;
wf_FilterVsl()
end event

type cbx_rep from checkbox within tp6
integer x = 1774
integer y = 80
integer width = 421
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "VIMS Statistics"
end type

event clicked;
wf_FilterVsl()
end event

type cbx_tract from checkbox within tp6
integer x = 1243
integer y = 80
integer width = 494
integer height = 80
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Active In Tramos"
boolean checked = true
end type

event clicked;
wf_FilterVsl()
end event

type sle_vfind from singlelineedit within tp6
event ue_keyup pbm_keyup
integer x = 384
integer y = 80
integer width = 567
integer height = 80
integer taborder = 170
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
borderstyle borderstyle = stylelowered!
end type

event ue_keyup;
Post wf_FilterVsl()
end event

type st_22 from statictext within tp6
integer x = 73
integer y = 96
integer width = 347
integer height = 64
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Search Text:"
boolean focusrectangle = false
end type

type dw_vslall from datawindow within tp6
integer x = 55
integer y = 176
integer width = 3602
integer height = 1760
integer taborder = 200
string dataobject = "d_sq_tb_vslfull"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemchanged;
If data="1" Then
	If (IsNull(this.GetItemString(row,"vtype")) Or IsNull(this.GetItemNumber(row,"imo")) Or IsNull(this.GetItemString(row,"office")) Or IsNull(this.GetItemString(row,"country_country_name")) Or IsNull(this.GetItemNumber(row,"fgid")) Or (this.GetItemNumber(row,"vessels_vessel_active")=0)) Then 
		String ls_Missing
		
		If this.GetItemNumber(row,"vessels_vessel_active")=0 Then ls_Missing+="- Vessel Active~n"
		If IsNull(this.GetItemString(row,"vtype")) Then ls_Missing+="- Vessel Type~n"
		If IsNull(this.GetItemNumber(row,"imo")) Then ls_Missing+="- IMO Number~n"
		If IsNull(this.GetItemString(row,"office")) Then ls_Missing+="- Vetting Office~n"
		If IsNull(this.GetItemString(row,"country_country_name")) Then ls_Missing+="- Vessel Flag~n"
		If IsNull(this.GetItemNumber(row,"fgid"))	Then ls_Missing+="- Fleet Group~n"
		
		Messagebox("Cannot Activate", "This option cannot be activated as the vessel is not ready for VIMS.~nThe following fields must be set:~n~n"+ls_Missing,Exclamation!)
		Return 2
	End If
End If

post wf_SaveVessel()
end event

event clicked;String ls_Sort

If row>0 Then
	if dwo.name="imocount" then
		sle_vfind.text=String(this.getItemNumber(row,"imo"))
		cbx_tract.checked=false
		cbx_rep.checked=false
		cbx_sn.checked=false
		cbx_invims.checked=false
		wf_filtervsl( )
	End If
Else
	If (dwo.type = "text") then
		ls_Sort = trim(dwo.Tag)
		If Len(ls_Sort) > 1 then
			this.setSort(ls_sort)
			this.Sort()
			if right(ls_sort,1) = "A" then 
				ls_sort = replace(ls_sort, len(ls_sort),1, "D")
			else
				ls_sort = replace(ls_sort, len(ls_sort),1, "A")
			end if
			dwo.Tag = ls_sort
		End If
	End if
End If
end event

type gb_24 from groupbox within tp6
integer x = 18
integer y = 16
integer width = 3675
integer height = 1952
integer taborder = 10
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Tramos Vessel Status"
end type

type tp4 from userobject within tab_admin
integer x = 18
integer y = 112
integer width = 3712
integer height = 2000
long backcolor = 67108864
string text = "VIMS Mobile"
long tabtextcolor = 33554432
long picturemaskcolor = 536870912
cb_3 cb_3
cb_2 cb_2
cb_sendpass cb_sendpass
cb_1 cb_1
cb_ping cb_ping
cb_dupe cb_dupe
cb_password cb_password
cb_ddl cb_ddl
st_dbstatus st_dbstatus
st_9 st_9
st_8 st_8
st_7 st_7
cb_userupdate cb_userupdate
cb_vslupdate cb_vslupdate
st_12 st_12
st_dblast st_dblast
cb_dbissue cb_dbissue
st_dbver st_dbver
st_10 st_10
dw_userver dw_userver
cb_vmicuser cb_vmicuser
cb_vmicvsl cb_vmicvsl
dw_vslver dw_vslver
gb_11 gb_11
gb_13 gb_13
end type

on tp4.create
this.cb_3=create cb_3
this.cb_2=create cb_2
this.cb_sendpass=create cb_sendpass
this.cb_1=create cb_1
this.cb_ping=create cb_ping
this.cb_dupe=create cb_dupe
this.cb_password=create cb_password
this.cb_ddl=create cb_ddl
this.st_dbstatus=create st_dbstatus
this.st_9=create st_9
this.st_8=create st_8
this.st_7=create st_7
this.cb_userupdate=create cb_userupdate
this.cb_vslupdate=create cb_vslupdate
this.st_12=create st_12
this.st_dblast=create st_dblast
this.cb_dbissue=create cb_dbissue
this.st_dbver=create st_dbver
this.st_10=create st_10
this.dw_userver=create dw_userver
this.cb_vmicuser=create cb_vmicuser
this.cb_vmicvsl=create cb_vmicvsl
this.dw_vslver=create dw_vslver
this.gb_11=create gb_11
this.gb_13=create gb_13
this.Control[]={this.cb_3,&
this.cb_2,&
this.cb_sendpass,&
this.cb_1,&
this.cb_ping,&
this.cb_dupe,&
this.cb_password,&
this.cb_ddl,&
this.st_dbstatus,&
this.st_9,&
this.st_8,&
this.st_7,&
this.cb_userupdate,&
this.cb_vslupdate,&
this.st_12,&
this.st_dblast,&
this.cb_dbissue,&
this.st_dbver,&
this.st_10,&
this.dw_userver,&
this.cb_vmicuser,&
this.cb_vmicvsl,&
this.dw_vslver,&
this.gb_11,&
this.gb_13}
end on

on tp4.destroy
destroy(this.cb_3)
destroy(this.cb_2)
destroy(this.cb_sendpass)
destroy(this.cb_1)
destroy(this.cb_ping)
destroy(this.cb_dupe)
destroy(this.cb_password)
destroy(this.cb_ddl)
destroy(this.st_dbstatus)
destroy(this.st_9)
destroy(this.st_8)
destroy(this.st_7)
destroy(this.cb_userupdate)
destroy(this.cb_vslupdate)
destroy(this.st_12)
destroy(this.st_dblast)
destroy(this.cb_dbissue)
destroy(this.st_dbver)
destroy(this.st_10)
destroy(this.dw_userver)
destroy(this.cb_vmicuser)
destroy(this.cb_vmicvsl)
destroy(this.dw_vslver)
destroy(this.gb_11)
destroy(this.gb_13)
end on

type cb_3 from commandbutton within tp4
integer x = 3182
integer y = 1744
integer width = 475
integer height = 160
integer taborder = 230
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "View DB Log"
end type

event clicked;
OpenSheet(w_vmdblog, w_main, 0, Original!)
end event

type cb_2 from commandbutton within tp4
boolean visible = false
integer x = 3291
integer y = 1600
integer width = 370
integer height = 80
integer taborder = 190
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Att Transfer"
end type

event clicked;
Open(w_TransferAtt)
end event

type cb_sendpass from commandbutton within tp4
integer x = 1445
integer y = 1536
integer width = 457
integer height = 80
integer taborder = 240
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Email Passwords..."
end type

event clicked;
// Get UserID
g_obj.ObjParent = w_Admin.tab_admin.tp4.dw_userver.GetItemString(w_Admin.tab_admin.tp4.dw_userver.GetRow(), "userid")

Open(w_sendpw)
end event

type cb_1 from commandbutton within tp4
integer x = 2926
integer y = 1648
integer width = 366
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Delete PW"
end type

event clicked;
Open(w_dropdbpw)
end event

type cb_ping from commandbutton within tp4
integer x = 987
integer y = 768
integer width = 457
integer height = 80
integer taborder = 220
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Ping Vessel"
end type

event clicked;
Integer li_File
String ls_Email, ls_Temp
Boolean lbool_Manual = False

// Get vessel email
ls_Email = w_Admin.tab_admin.tp4.dw_vslver.GetItemString(w_Admin.tab_admin.tp4.dw_vslver.GetRow(), "Vessel_Email")

If IsNull(ls_Email) or ls_Email="" or Pos(ls_Email, "@") = 0 then 
	If MessageBox("Ping Vessel", "The selected vessel does not have a email address specified.~n~nDo you want to ping manually?", Question!, YesNo!) = 2 then Return
	lbool_Manual = True	
Else
	If MessageBox("Ping Vessel", "Are you sure you want to ping the vessel?", Question!, YesNo!) = 2 then Return
End If

If lbool_Manual then  // Let user select folder
	ls_Temp = "C:\"
	If GetFolder("Select the folder to create the ping file in:", ls_Temp) < 1 then Return
Else
	ls_Temp = g_Obj.AppFolder
End If

If Right(ls_Temp, 1) <> "\" Then ls_Temp += "\"

// If ping file does not exist in app folder, then create one
If Not FileExists(g_Obj.AppFolder + "vping.vpkg") then
	li_File = FileOpen("vping.vpkg", TextMode!, Write!, LockReadWrite!, Replace!)
	If li_File < 0 then
		Messagebox("Ping Error", "Unable to create ping file", Exclamation!)
		Return
	End If
	FileWriteEx(li_File, "PING")
	FileClose(li_File)
End If

If lbool_Manual then  // If manual, copy to selected folder
	li_File = FileCopy(g_Obj.AppFolder + "vping.vpkg", ls_Temp + "vping.vpkg", True)
	If li_File < 0 then
		Messagebox("Ping Error", "Unable to copy ping file", Exclamation!)
		Return		
	End If
	Messagebox("Ping Vessel", "Ping file 'vping.vpkg' created in folder " + ls_Temp + "~n~nPlease email this file to the vessel.", Information!)
	Return
End If

// Otherwise create email
If guo_Global.of_SendMail2Vessel(ls_email, "VIMS Ping", g_Obj.AppFolder + "vping.vpkg")="" then Messagebox("Ping Sent", "The ping was successfully sent out to the following email:~n~n" + ls_email, Information!)

end event

type cb_dupe from commandbutton within tp4
integer x = 3163
integer y = 16
integer width = 494
integer height = 80
integer taborder = 160
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Duplicate Vessels"
end type

event clicked;
Open(w_DupVessel)
end event

type cb_password from commandbutton within tp4
integer x = 987
integer y = 1536
integer width = 457
integer height = 80
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Mobile Password"
end type

event clicked;
// Get userid
g_obj.objparent = w_Admin.tab_admin.tp4.dw_userver.GetItemString(w_Admin.tab_admin.tp4.dw_userver.GetRow(), "userid")

Open(w_mobilepassword)
end event

type cb_ddl from commandbutton within tp4
integer x = 3291
integer y = 1648
integer width = 366
integer height = 80
integer taborder = 230
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "SQL DDL"
end type

event clicked;
g_Obj.Level = Integer(tab_admin.tp4.st_dbver.Text)

Open(w_verifysa)
end event

type st_dbstatus from statictext within tp4
integer x = 1627
integer y = 1840
integer width = 677
integer height = 80
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 8388608
string text = "xxxx"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_9 from statictext within tp4
integer x = 73
integer y = 864
integer width = 421
integer height = 64
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Inspectors:"
boolean focusrectangle = false
end type

type st_8 from statictext within tp4
integer x = 73
integer y = 96
integer width = 293
integer height = 64
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Vessels:"
boolean focusrectangle = false
end type

type st_7 from statictext within tp4
integer x = 1627
integer y = 1744
integer width = 677
integer height = 64
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
string text = "Database Status"
alignment alignment = center!
boolean focusrectangle = false
end type

type cb_userupdate from commandbutton within tp4
integer x = 530
integer y = 1536
integer width = 457
integer height = 80
integer taborder = 220
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Edit VM Details"
end type

event clicked;Integer li_Row

li_Row = w_Admin.tab_admin.tp4.dw_userver.GetRow()

g_obj.level = 1   // Inspector

// Get UserID
g_obj.objparent = w_Admin.tab_admin.tp4.dw_userver.GetItemString(li_Row, "userid")

// Versions
g_obj.Objid = w_Admin.tab_admin.tp4.dw_userver.GetItemNumber(li_Row, "dbver")
g_obj.Sql = w_Admin.tab_admin.tp4.dw_userver.GetItemString(li_Row, "vimsver")

Open(w_mobilever)

If (g_Obj.Objid >= 0) or IsNull(g_Obj.Objid) then
	w_Admin.tab_admin.tp4.dw_userver.SetItem(li_Row, "dbver", g_Obj.Objid)
	w_Admin.tab_admin.tp4.dw_userver.SetItem(li_Row, "vimsver", g_Obj.Sql)
	If w_Admin.tab_admin.tp4.dw_userver.Update() = -1 then
		Messagebox("Update Failed", "The data could not be updated!", Exclamation!)
		w_Admin.tab_admin.tp4.dw_userver.Retrieve( )
	End If	
End If


	
end event

type cb_vslupdate from commandbutton within tp4
integer x = 530
integer y = 768
integer width = 457
integer height = 80
integer taborder = 210
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Edit VM Details"
end type

event clicked;
Integer li_Row

li_Row = w_Admin.tab_admin.tp4.dw_vslver.GetRow()

g_obj.level = 0   // Vessel 

// Get IMO number
g_obj.vesselimo = w_Admin.tab_admin.tp4.dw_vslver.GetItemNumber(li_Row, "imo")

g_obj.Objid = w_Admin.tab_admin.tp4.dw_vslver.GetItemNumber(li_Row, "dbver")
g_obj.Sql = w_Admin.tab_admin.tp4.dw_vslver.GetItemString(li_Row, "vimsver")

// Open window
Open(w_mobilever)

If (g_Obj.Objid >= 0) or IsNull(g_Obj.Objid) then
	w_Admin.tab_admin.tp4.dw_vslver.SetItem(li_Row, "dbver", g_Obj.Objid)
	w_Admin.tab_admin.tp4.dw_vslver.SetItem(li_Row, "vimsver", g_Obj.Sql)
	If w_Admin.tab_admin.tp4.dw_vslver.Update() = -1 then
		Messagebox("Update Failed", "The data could not be updated!", Exclamation!)
		w_Admin.tab_admin.tp4.dw_vslver.Retrieve( )
	End If	
End If


end event

type st_12 from statictext within tp4
integer x = 933
integer y = 1744
integer width = 530
integer height = 64
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long backcolor = 67108864
string text = "Last Issued"
alignment alignment = center!
boolean focusrectangle = false
end type

type st_dblast from statictext within tp4
integer x = 933
integer y = 1840
integer width = 530
integer height = 80
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 8388608
string text = "xxxx"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type cb_dbissue from commandbutton within tp4
integer x = 2450
integer y = 1744
integer width = 731
integer height = 160
integer taborder = 220
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Issue New Update"
end type

event clicked;String ls_Path
Integer li_IDFile
Long ll_TotalRows
Boolean lbool_err

If g_obj.dbmodif = 0 then
	If Messagebox("Confirm DB Update", "The database has not been modified since the last issue. Do you still want to issue an update?", Question!, YesNo!) = 2 Then Return
End If

If GetFolder("Select the folder where the DB update will be created:", ls_Path) < 1 then Return -1

If Right(ls_Path,1) <> "\" then ls_Path += "\"

SetPointer(HourGlass!)

ll_TotalRows = 0
lbool_err = False

ll_TotalRows += wf_CreateXML("d_sq_tb_sqlissue", ls_Path + "SQL", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_vmvessels", ls_Path + "Vessels", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_country", ls_Path + "Country", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_ports", ls_Path + "Ports", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_inspmodel", ls_Path + "InspModel", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_notes", ls_Path + "Notes", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_text", ls_Path + "Text", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_obj", ls_Path + "Obj", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_summarytypes", ls_Path + "SmTypes", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_comp", ls_Path + "Comp", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_cause", ls_Path + "Cause", lbool_err)
ll_TotalRows += wf_CreateXML("d_sq_tb_io_resp", ls_Path + "Resp", lbool_err)

If lbool_err then
	Messagebox("File Error", "Unable to retrieve/create XML tables. The update could not be created.", Exclamation!)
	Return
End If

// Create identity file (to store DB information)
li_IDFile = FileOpen (ls_Path + 'DB_ID.vdbxp', LineMode!, Write!, LockReadWrite!, Replace!, EncodingUTF8!)
If (li_IDFile <= 0) then
	Messagebox("File Error", "Unable to create DB ID File. The update could not be created.", Exclamation!)
	Return
End If

FileWriteEx(li_IDFile, "DB Update ID File")   // Title
FileWriteEx(li_IDFile, "Issued: " + String(Today(), "dd mmm yyyy"))  // Date of issue
FileWriteEx(li_IDFile, "DBIssue: " + String(Integer(st_DBVer.Text)+1))  // DB version
FileWriteEx(li_IDFile, "By: " + g_Obj.UserID)  // User
FileWriteEx(li_IDFile, "Rows: " + String(ll_TotalRows))  // Total rows exported
If FileClose(li_IDFile) = -1 then
	Messagebox("File Error", "Unable to close DB ID File. The update could not be created.", Exclamation!)
	Return	
End If

If invo_fpack.PackFiles('db_' + String(Integer(st_DBVer.Text)+1), ls_Path, ls_Path) = 0 then
	MessageBox("DB Update Created", "A new Database Update was created successfully in the selected folder.~n~nThis file must be sent to all VIMS Mobile installations.")	
Else
	MessageBox("File Error", "A new Database Update could not be issued. Please check the network/path selected.")	
	Return
End If

ls_Path = String(Integer(tab_admin.tp4.st_dbver.Text) + 1)

If f_Config("DBVR", ls_Path, 1) = 0 then  // If version incremented successfully
	tab_admin.tp4.st_dbver.Text = ls_Path
	ls_Path = String(Today(), "dd mmm yyyy")
	f_Config("DBLI", ls_Path, 1)
	tab_admin.tp4.st_dblast.Text = ls_Path
	g_obj.DBModif = 0
	ls_Path = "0"
	f_Config("DBST", ls_Path, 1)
	w_setdbstatus(0)
End If



end event

type st_dbver from statictext within tp4
integer x = 366
integer y = 1840
integer width = 219
integer height = 80
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 16777215
long backcolor = 8388608
string text = "x"
alignment alignment = center!
boolean border = true
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
end type

type st_10 from statictext within tp4
integer x = 201
integer y = 1744
integer width = 567
integer height = 64
integer textsize = -10
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "Current DB Issue"
alignment alignment = center!
boolean focusrectangle = false
end type

type dw_userver from datawindow within tp4
integer x = 73
integer y = 928
integer width = 3566
integer height = 608
integer taborder = 190
string title = "none"
string dataobject = "d_sq_tb_userver"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event clicked;string ls_sort

If (dwo.type = "text") then
	If (dwo.tag>"") then
		ls_sort = dwo.Tag
		this.setSort(ls_sort)
		this.Sort()
		if right(ls_sort,1) = "A" then 
			ls_sort = replace(ls_sort, len(ls_sort),1, "D")
		else
			ls_sort = replace(ls_sort, len(ls_sort),1, "A")
		end if
		dwo.Tag = ls_sort
	End If
End if

end event

event rowfocuschanged;
// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to refresh the row colors when using arrow keys to navigate
This.SetRedraw(False)
This.SetRedraw(True)
end event

type cb_vmicuser from commandbutton within tp4
integer x = 73
integer y = 1536
integer width = 457
integer height = 80
integer taborder = 210
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Generate VMIC"
end type

event clicked;
g_obj.level = 1   // Inspector VMIC

// Get UserID
g_obj.objparent = w_Admin.tab_admin.tp4.dw_userver.GetItemString(w_Admin.tab_admin.tp4.dw_userver.GetRow(), "userid")

// Get user name
g_obj.objstring = w_Admin.tab_admin.tp4.dw_userver.GetItemString(w_Admin.tab_admin.tp4.dw_userver.GetRow(), "fname")
g_obj.sql = w_Admin.tab_admin.tp4.dw_userver.GetItemString(w_Admin.tab_admin.tp4.dw_userver.GetRow(), "lname")

// Calc and show VMIC
Open(w_VMIC)
end event

type cb_vmicvsl from commandbutton within tp4
integer x = 73
integer y = 768
integer width = 457
integer height = 80
integer taborder = 200
integer textsize = -8
integer weight = 400
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
string text = "Generate VMIC"
end type

event clicked;
g_obj.level = 0   // Vessel VMIC

// Get IMO number
g_obj.vesselimo = w_Admin.tab_admin.tp4.dw_vslver.GetItemNumber(w_Admin.tab_admin.tp4.dw_vslver.GetRow(), "imo")

// Get Vessel name
g_obj.objstring = w_Admin.tab_admin.tp4.dw_vslver.GetItemString(w_Admin.tab_admin.tp4.dw_vslver.GetRow(), "vessel_name")

// Get Vessel number
g_obj.sql = w_Admin.tab_admin.tp4.dw_vslver.GetItemString(w_Admin.tab_admin.tp4.dw_vslver.GetRow(), "vessel_ref_nr")

// Calc and show VMIC
Open(w_VMIC)
end event

type dw_vslver from datawindow within tp4
integer x = 73
integer y = 160
integer width = 3566
integer height = 608
integer taborder = 180
string title = "none"
string dataobject = "d_sq_tb_vslver"
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event clicked;string ls_sort

If (dwo.type = "text") then
	If (dwo.tag>"") then
		ls_sort = dwo.Tag
		this.setSort(ls_sort)
		this.Sort()
		if right(ls_sort,1) = "A" then 
			ls_sort = replace(ls_sort, len(ls_sort),1, "D")
		else
			ls_sort = replace(ls_sort, len(ls_sort),1, "A")
		end if
		dwo.Tag = ls_sort
	End If
End if

end event

event rowfocuschanged;
// PB Bug - Detail background colour does not refresh when using arrow keys to select rows
// Workaround: This must be done to refresh the row colors when using arrow keys to navigate
This.SetRedraw(False)
This.SetRedraw(True)
end event

type gb_11 from groupbox within tp4
integer x = 37
integer y = 32
integer width = 3639
integer height = 1600
integer taborder = 170
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "VIMS Mobile Installations"
end type

type gb_13 from groupbox within tp4
integer x = 37
integer y = 1648
integer width = 3639
integer height = 320
integer taborder = 210
integer textsize = -8
integer weight = 700
fontcharset fontcharset = ansi!
fontpitch fontpitch = variable!
fontfamily fontfamily = swiss!
string facename = "Tahoma"
long textcolor = 33554432
long backcolor = 67108864
string text = "VIMS Mobile Database"
end type

